# Fiido æ™ºèƒ½å®¢æœç³»ç»Ÿ

## é¡¹ç›®æ¦‚è¿°

ä¸€å¥—å®Œæ•´çš„ä¼ä¸šçº§æ™ºèƒ½å®¢æœè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ **AI è‡ªåŠ¨åº”ç­” + äººå·¥æ¥ç®¡** åŒæ¨¡å¼ã€‚é€‚ç”¨äºç”µå•†ç‹¬ç«‹ç«™ã€SaaS å¹³å°ç­‰éœ€è¦å®¢æœæ”¯æŒçš„åœºæ™¯ã€‚

### æ ¸å¿ƒèƒ½åŠ›

- **AI æ™ºèƒ½å¯¹è¯** - åŸºäº Coze Workflowï¼Œæ”¯æŒå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡ç†è§£
- **äººå·¥æ— ç¼æ¥ç®¡** - AI æ— æ³•è§£å†³æ—¶è‡ªåŠ¨/æ‰‹åŠ¨è½¬äººå·¥ï¼Œæ”¯æŒä¼šè¯è½¬æ¥
- **å®æ—¶æ¶ˆæ¯æ¨é€** - SSE é•¿è¿æ¥ï¼Œåå¸­æ¶ˆæ¯å³æ—¶é€è¾¾
- **å®Œæ•´çŠ¶æ€ç®¡ç†** - 5 ç§ä¼šè¯çŠ¶æ€ï¼Œæ”¯æŒæœåŠ¡é—­ç¯
- **åå¸­å·¥ä½œå°** - ç‹¬ç«‹çš„åå¸­ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šåå¸­åä½œ

### æŠ€æœ¯æ ˆ

| æ¨¡å— | æŠ€æœ¯ |
|------|------|
| åç«¯ | FastAPI + Python 3.10+ |
| å‰ç«¯ | Vue 3 + TypeScript + Pinia |
| AI å¼•æ“ | Coze Workflow API |
| é‰´æƒ | OAuth 2.0 + JWT |
| å®æ—¶é€šä¿¡ | Server-Sent Events (SSE) |

### ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·æµè§ˆå™¨ â†â†’ Vueå‰ç«¯ â†â†’ FastAPIåç«¯ â†â†’ Coze AI
                              â†“
                        åå¸­å·¥ä½œå° (Vue)
```

### ä¼šè¯çŠ¶æ€æµè½¬

```
bot_active â†’ pending_manual â†’ manual_live â†’ bot_active
   (AIæœåŠ¡)    (ç­‰å¾…äººå·¥)      (äººå·¥æœåŠ¡)    (æ¢å¤AI)
```

### é€‚ç”¨åœºæ™¯

- ç”µå•†ç‹¬ç«‹ç«™å®¢æœ
- SaaS äº§å“æŠ€æœ¯æ”¯æŒ
- åœ¨çº¿å’¨è¯¢æœåŠ¡
- å”®å‰/å”®åæœåŠ¡ä¸­å¿ƒ

---

## å½“å‰ç‰ˆæœ¬: v3.1.3

**å‘å¸ƒæ—¥æœŸ**: 2025-11-25

**åŠŸèƒ½å®Œæˆåº¦**: 98% (P0+P1 å…¨éƒ¨å®Œæˆï¼ŒP2 å¾…å¼€å‘)

**ç³»ç»ŸçŠ¶æ€**: ğŸ¯ **ç”Ÿäº§å¯ç”¨ (Production Ready)** - ä¼ä¸šçº§åŠŸèƒ½å®Œæ•´

**PRD æ–‡æ¡£**: è§ `prd/INDEX.md` (20ä¸ªéœ€æ±‚æ–‡æ¡£ï¼ŒæŒ‰6ä¸ªåˆ†ç±»ç»„ç»‡)

**æœ€æ–°æ›´æ–°**:
- âœ… ç®¡ç†å‘˜åŠŸèƒ½å®Œæ•´å®ç°ï¼ˆåå¸­ CRUDã€æƒé™æ§åˆ¶ï¼‰- v3.1.1
- âœ… åå¸­è‡ªåŠ©åŠŸèƒ½ï¼ˆä¿®æ”¹å¯†ç ã€ä¿®æ”¹èµ„æ–™ï¼‰- v3.1.2/v3.1.3
- âœ… Fiido E-bike ä¸šåŠ¡éœ€æ±‚æ•´åˆ - v3.1.0
- âœ… ä¿®å¤ä¼šè¯éš”ç¦» SSL è¶…æ—¶é—®é¢˜ - v3.1.3

**å·²å®ŒæˆåŠŸèƒ½**: P0 æ ¸å¿ƒåŠŸèƒ½ + P0 ç®¡ç†å‘˜åŠŸèƒ½ + P1 è‡ªåŠ©åŠŸèƒ½ + P1 å¢å¼ºåŠŸèƒ½

---

åŸºäº Coze å¯¹è¯æµçš„æ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œæ”¯æŒ OAuth+JWT é‰´æƒã€å®Œç¾çš„ä¼šè¯éš”ç¦»å’Œ Vue 3 å‰ç«¯ã€‚

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org)
[![FastAPI](https://img.shields.io/badge/FastAPI-Latest-green.svg)](https://fastapi.tiangolo.com)
[![Vue](https://img.shields.io/badge/Vue-3.5-brightgreen.svg)](https://vuejs.org)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.7-blue.svg)](https://www.typescriptlang.org)
[![Coze](https://img.shields.io/badge/Coze-Workflow-orange.svg)](https://www.coze.com)

---

## ğŸ¯ é‡è¦æ–‡æ¡£ï¼ˆå¿…è¯»ï¼‰

### ä¼šè¯éš”ç¦»è§£å†³æ–¹æ¡ˆ

âš ï¸ **å¦‚æœæ‚¨åœ¨å®ç°å¤šç”¨æˆ·ä¼šè¯éš”ç¦»æ—¶é‡åˆ°é—®é¢˜ï¼Œå¿…è¯»æ­¤æ–‡æ¡£ï¼š**

ğŸ“– **[Cozeä¼šè¯éš”ç¦»æœ€ç»ˆè§£å†³æ–¹æ¡ˆ.md](./Cozeä¼šè¯éš”ç¦»æœ€ç»ˆè§£å†³æ–¹æ¡ˆ.md)** ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰

**æ ¸å¿ƒè¦ç‚¹**ï¼š
- âœ… å¿…é¡»åœ¨ç”¨æˆ·æ‰“å¼€é¡µé¢æ—¶ç«‹å³è°ƒç”¨ `conversations.create()` API
- âŒ ä¸èƒ½ä¾èµ–é¦–æ¬¡å¯¹è¯æ—¶ Coze è‡ªåŠ¨ç”Ÿæˆ conversation_id
- âœ… è¿™æ˜¯åŸºäº Coze å¼€å‘çš„æ­£ç¡®å®è·µï¼Œå·²å®é™…éªŒè¯é€šè¿‡

**é—®é¢˜ç¤ºä¾‹**ï¼š
```
çª—å£ 1: "æˆ‘æ˜¯å­è±ª"
çª—å£ 2: "æˆ‘æ˜¯è°ï¼Ÿ"
AI å›ç­”: "ä½ æ˜¯å­è±ª" â† è¿™æ˜¯é”™è¯¯çš„ï¼åº”è¯¥ä¸çŸ¥é“
```

**è§£å†³æ–¹æ¡ˆè§**: [å®Œæ•´æ–‡æ¡£](./Cozeä¼šè¯éš”ç¦»æœ€ç»ˆè§£å†³æ–¹æ¡ˆ.md)

---

## âœ¨ ç‰¹æ€§

### åç«¯ç‰¹æ€§
- âœ… **OAuth+JWT é‰´æƒ** - å®‰å…¨çš„è®¿é—®å¯†é’¥ç®¡ç†
- âœ… **ä¼šè¯éš”ç¦»** - åŸºäº `session_name` çš„å¤šç”¨æˆ·ä¼šè¯éš”ç¦»
- âœ… **å¯¹è¯å†å²ç®¡ç†** - åŸºäº `conversation_id` çš„å†å²ä¿ç•™
- âœ… **æµå¼/åŒæ­¥åŒæ¥å£** - æ”¯æŒå®æ—¶å“åº”å’Œæ‰¹é‡å“åº”
- âœ… **Token è‡ªåŠ¨ç®¡ç†** - æŒ‰ä¼šè¯ç¼“å­˜å’Œåˆ·æ–° JWT Token
- âœ… **Chat SDK æ”¯æŒ** - æä¾›å‰ç«¯ SDK token ç”Ÿæˆæ¥å£

### å‰ç«¯ç‰¹æ€§
- âœ… **Vue 3 æ¡†æ¶ç‰ˆæœ¬** - ç°ä»£åŒ–çš„å‰ç«¯æ¶æ„
- âœ… **Fiido å®˜ç½‘è®¾è®¡** - å®Œå…¨å¤åˆ» fiido.com ç•Œé¢é£æ ¼
- âœ… **æµå¼å“åº”** - é€å­—æ˜¾ç¤ºAIå›å¤
- âœ… **Markdown æ¸²æŸ“** - æ”¯æŒå¯Œæ–‡æœ¬æ¶ˆæ¯
- âœ… **æ°”æ³¡èœå•** - ä¼˜é›…çš„æµ®åŠ¨æ“ä½œèœå•
- âœ… **å¯¹è¯/ä¼šè¯ç®¡ç†** - æ¸…é™¤å¯¹è¯ã€æ–°å»ºä¼šè¯åŠŸèƒ½
- âœ… **å†å²åˆ†éš”çº¿** - æ¸…æ™°åŒºåˆ†å¯¹è¯å†å²
- âœ… **äº§å“å’¨è¯¢** - å¿«æ·äº§å“å’¨è¯¢å…¥å£
- âœ… **å“åº”å¼è®¾è®¡** - æ”¯æŒç§»åŠ¨ç«¯å’ŒPCç«¯
- âœ… **å±€åŸŸç½‘è®¿é—®** - æ”¯æŒåŒä¸€ç½‘ç»œä¸‹å¤šè®¾å¤‡è®¿é—®

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åç«¯å¯åŠ¨

#### 1. ç¯å¢ƒè¦æ±‚

- Python 3.10+
- pip æˆ– pip3

#### 2. å®‰è£…ä¾èµ–

```bash
pip3 install -r requirements.txt
```

#### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```bash
# Coze API é…ç½®
COZE_API_BASE=https://api.coze.com
COZE_AUTH_MODE=OAUTH_JWT
COZE_WORKFLOW_ID=ä½ çš„å·¥ä½œæµID
COZE_APP_ID=ä½ çš„åº”ç”¨ID

# OAuth é…ç½®
COZE_OAUTH_CLIENT_ID=ä½ çš„ClientID
COZE_OAUTH_PUBLIC_KEY_ID=ä½ çš„å…¬é’¥æŒ‡çº¹
COZE_OAUTH_PRIVATE_KEY_FILE=./private_key.pem

# æœåŠ¡å™¨é…ç½®
HOST=0.0.0.0
PORT=8000
```

è¯¦ç»†é…ç½®è¯´æ˜è§ [é…ç½®æŒ‡å—](docs/é…ç½®æŒ‡å—.md)

#### 4. å¯åŠ¨æœåŠ¡

```bash
python3 backend.py
```

**è®¿é—®åœ°å€**: `http://localhost:8000`
**APIæ–‡æ¡£**: `http://localhost:8000/docs`

---

### å‰ç«¯å¯åŠ¨ï¼ˆç”¨æˆ·ç«¯ï¼‰

æœ¬é¡¹ç›®ä½¿ç”¨ **Vue 3 + TypeScript** ç°ä»£åŒ–å‰ç«¯æ¡†æ¶ã€‚

#### ç¯å¢ƒè¦æ±‚
- Node.js 16+
- npm æˆ– yarn

#### å¯åŠ¨æ–¹å¼

**æ–¹å¼ A: æ‰‹åŠ¨å¯åŠ¨**
```bash
cd frontend
npm install
npm run dev
```

**æ–¹å¼ B: ä½¿ç”¨å¯åŠ¨è„šæœ¬**
```bash
./å¯åŠ¨-Vueå‰ç«¯.sh
```

**è®¿é—®åœ°å€**:
- æœ¬åœ°: `http://localhost:5173`
- å±€åŸŸç½‘: `http://<ä½ çš„IP>:5173`

---

### åå¸­å·¥ä½œå°å¯åŠ¨

åå¸­å·¥ä½œå°æ˜¯ç‹¬ç«‹çš„ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºåå¸­æ¥å…¥äººå·¥ä¼šè¯ã€‚

#### å¯åŠ¨æ–¹å¼

```bash
cd agent-workbench
npm install
npm run dev
```

**è®¿é—®åœ°å€**:
- æœ¬åœ°: `http://localhost:5174`ï¼ˆç«¯å£å¯èƒ½ä¸º5174/5175ï¼‰
- å±€åŸŸç½‘: `http://<ä½ çš„IP>:5174`

**é»˜è®¤è´¦å·**:
- ç®¡ç†å‘˜: `admin` / `admin123`
- åå¸­1: `agent001` / `agent123`
- åå¸­2: `agent002` / `agent123`

---

### ğŸ¯ å®Œæ•´æœåŠ¡è®¿é—®åœ°å€

| æœåŠ¡ | æœ¬åœ°åœ°å€ | å±€åŸŸç½‘åœ°å€ | è¯´æ˜ |
|------|---------|-----------|------|
| åç«¯API | http://localhost:8000 | http://192.168.x.x:8000 | FastAPIåç«¯ |
| APIæ–‡æ¡£ | http://localhost:8000/docs | http://192.168.x.x:8000/docs | Swagger UI |
| ç”¨æˆ·ç«¯ | http://localhost:5173 | http://192.168.x.x:5173 | Vueå‰ç«¯ |
| åå¸­å·¥ä½œå° | http://localhost:5174 | http://192.168.x.x:5174 | åå¸­ç®¡ç†ç³»ç»Ÿ |

**æ³¨æ„**: åå¸­å·¥ä½œå°ç«¯å£å¯èƒ½ä¸º5174æˆ–5175ï¼Œå…·ä½“æŸ¥çœ‹ç»ˆç«¯è¾“å‡º

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
fiido-customer-service/
â”œâ”€â”€ README.md                       # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ requirements.txt                # Python ä¾èµ–
â”œâ”€â”€ .env                            # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ private_key.pem                 # OAuth ç§é’¥
â”‚
â”œâ”€â”€ backend.py                      # FastAPI åç«¯ä¸»ç¨‹åº
â”œâ”€â”€ fiido2.png                      # å®¢æœå¤´åƒ
â”œâ”€â”€ å¯åŠ¨-Vueå‰ç«¯.sh                  # Vue å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ frontend/                       # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.ts                 # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.vue                 # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/             # Vue ç»„ä»¶ (8ä¸ª)
â”‚   â”‚   â”‚   â”œâ”€â”€ AppHeader.vue       # å¯¼èˆªæ 
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroSection.vue     # HeroåŒºåŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductsSection.vue # äº§å“å±•ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ AppFooter.vue       # é¡µè„š
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatFloatButton.vue # æµ®åŠ¨æŒ‰é’®
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatPanel.vue       # èŠå¤©é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatMessage.vue     # æ¶ˆæ¯ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ WelcomeScreen.vue   # æ¬¢è¿å±å¹•
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ chatStore.ts        # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ chat.ts             # API æ¥å£
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts            # TypeScript ç±»å‹
â”‚   â”‚   â””â”€â”€ assets/
â”‚   â”‚       â””â”€â”€ main.css            # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ fiido2.png              # å®¢æœå¤´åƒ
â”‚   â”œâ”€â”€ index.html                  # HTML å…¥å£
â”‚   â”œâ”€â”€ vite.config.ts              # Vite é…ç½®
â”‚   â”œâ”€â”€ package.json                # ä¾èµ–é…ç½®
â”‚   â””â”€â”€ .env                        # ç¯å¢ƒå˜é‡
â”‚
â”œâ”€â”€ src/                            # åç«¯æºä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ jwt_signer.py               # JWT ç­¾åå·¥å…·
â”‚   â””â”€â”€ oauth_token_manager.py      # OAuth Token ç®¡ç†å™¨
â”‚
â”œâ”€â”€ tests/                          # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ test_simple.py              # ç®€å•ä¼šè¯éš”ç¦»æµ‹è¯•
â”‚   â””â”€â”€ test_session_name.py        # å®Œæ•´ä¼šè¯éš”ç¦»æµ‹è¯•
â”‚
â”œâ”€â”€ docs/                           # æ–‡æ¡£
â”‚   â”œâ”€â”€ é…ç½®æŒ‡å—.md                  # é…ç½®è¯´æ˜
â”‚   â””â”€â”€ ä¼šè¯éš”ç¦»å®ç°å†ç¨‹.md          # å®ç°è¿‡ç¨‹è®°å½•
â”‚
â”œâ”€â”€ prd/                            # éœ€æ±‚æ–‡æ¡£
â”‚   â””â”€â”€ coze.md                     # Coze é›†æˆéœ€æ±‚æ–‡æ¡£
â”‚
â”œâ”€â”€ Cozeä¼šè¯éš”ç¦»æœ€ç»ˆè§£å†³æ–¹æ¡ˆ.md       # ä¼šè¯éš”ç¦»å®Œæ•´æ–¹æ¡ˆï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰
â”œâ”€â”€ æ–‡æ¡£æ¸…å•.md                      # æ–‡æ¡£ç´¢å¼•
â””â”€â”€ æ–‡æ¡£æ•´ç†å®Œæˆæ€»ç»“.md              # æ–‡æ¡£æ•´ç†æ€»ç»“
```

---

## ğŸ”Œ API æ¥å£

### 1. èŠå¤©æ¥å£ (åŒæ­¥)

**è¯·æ±‚**:
```bash
POST /api/chat
Content-Type: application/json

{
  "message": "ä½ å¥½",
  "user_id": "session_abc123",  # å¯é€‰,ä¸æä¾›åˆ™è‡ªåŠ¨ç”Ÿæˆ
  "conversation_id": "conv_123"  # å¯é€‰,ç”¨äºä¿ç•™å†å²
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "æ‚¨å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©æ‚¨çš„ï¼Ÿ"
}
```

### 2. èŠå¤©æ¥å£ (æµå¼)

**è¯·æ±‚**:
```bash
POST /api/chat/stream
Content-Type: application/json

{
  "message": "ä½ å¥½",
  "user_id": "session_abc123",
  "conversation_id": "conv_123"  # å¯é€‰
}
```

**å“åº”** (Server-Sent Events):
```
data: {"type": "message", "content": "æ‚¨"}
data: {"type": "message", "content": "å¥½"}
data: {"type": "message", "content": "ï¼"}
data: {"type": "done", "content": ""}
```

### 3. åˆ›å»ºæ–°å¯¹è¯

**è¯·æ±‚**:
```bash
POST /api/conversation/new
Content-Type: application/json

{
  "user_id": "session_abc123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "conversation_id": "conv_7433558367123783713"
}
```

### 4. ç”Ÿæˆ Chat SDK Token â­ æ–°å¢

**è¯·æ±‚**:
```bash
POST /api/chat/token
Content-Type: application/json

{
  "user_id": "session_abc123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 3600
}
```

### 5. è·å– Bot ä¿¡æ¯ â­ æ–°å¢

**è¯·æ±‚**:
```bash
GET /api/bot/info
```

**å“åº”**:
```json
{
  "success": true,
  "bot": {
    "name": "Fiido å®¢æœ",
    "description": "Fiido æ™ºèƒ½å®¢æœåŠ©æ‰‹",
    "icon_url": "https://..."
  }
}
```

### 6. å¥åº·æ£€æŸ¥

```bash
GET /api/health
```

---

## ğŸ¤– äººå·¥æ¥ç®¡ API (P0-4)

ä»¥ä¸‹APIç”¨äºå®ç°AIä¸äººå·¥å®¢æœçš„æ— ç¼åˆ‡æ¢ã€‚

### 7. äººå·¥å‡çº§æ¥å£

è§¦å‘äººå·¥æ¥ç®¡æµç¨‹ï¼Œå°†ä¼šè¯ä»AIæ¨¡å¼åˆ‡æ¢åˆ°å¾…äººå·¥æ¨¡å¼ã€‚

**è¯·æ±‚**:
```bash
POST /api/manual/escalate
Content-Type: application/json

{
  "session_name": "session_abc123",
  "reason": "user_request"  # æˆ–å…¶ä»–åŸå› 
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "session_name": "session_abc123",
    "status": "pending_manual",
    "escalation": {
      "reason": "manual",
      "details": "ç”¨æˆ·ä¸»åŠ¨è¯·æ±‚äººå·¥æœåŠ¡",
      "severity": "high"
    }
  }
}
```

**çŠ¶æ€ç **:
- `200`: å‡çº§æˆåŠŸ
- `409`: å·²åœ¨äººå·¥æ¥ç®¡ä¸­ (`MANUAL_IN_PROGRESS`)
- `400`: ç¼ºå°‘å¿…éœ€å‚æ•°

### 8. è·å–ä¼šè¯çŠ¶æ€

è·å–ä¼šè¯çš„å®Œæ•´çŠ¶æ€ï¼ŒåŒ…æ‹¬å†å²æ¶ˆæ¯å’Œå½“å‰çŠ¶æ€ã€‚

**è¯·æ±‚**:
```bash
GET /api/sessions/{session_name}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "session": {
      "session_name": "session_abc123",
      "status": "pending_manual",
      "history": [...],
      "escalation": {...},
      "assigned_agent": null
    },
    "audit_trail": []
  }
}
```

### 9. äººå·¥æ¶ˆæ¯å†™å…¥

åœ¨äººå·¥æ¥ç®¡æœŸé—´ï¼Œåå¸­æˆ–ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ã€‚

**è¯·æ±‚**:
```bash
POST /api/manual/messages
Content-Type: application/json

{
  "session_name": "session_abc123",
  "role": "agent",  # æˆ– "user"
  "content": "æ‚¨å¥½ï¼Œæˆ‘æ˜¯äººå·¥å®¢æœå°ç‹",
  "agent_info": {
    "agent_id": "agent_01",
    "agent_name": "å°ç‹"
  }
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "timestamp": 1763605000
  }
}
```

**è¯´æ˜**:
- `role` å¿…é¡»æ˜¯ `"agent"` æˆ– `"user"`
- ç”¨æˆ·æ¶ˆæ¯å¿…é¡»åœ¨ `manual_live` çŠ¶æ€ä¸‹å‘é€
- åå¸­æ¶ˆæ¯ä¼šé€šè¿‡SSEæ¨é€ç»™å‰ç«¯

### 10. åå¸­æ¥å…¥ä¼šè¯ (é˜²æŠ¢å•) âœ¨ **æ–°å¢**

åå¸­æ¥å…¥å¾…å¤„ç†çš„ä¼šè¯ï¼Œæ”¯æŒé˜²æŠ¢å•é€»è¾‘ã€‚

**è¯·æ±‚**:
```bash
POST /api/sessions/{session_name}/takeover
Content-Type: application/json

{
  "agent_id": "agent_001",
  "agent_name": "å°ç‹"
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "session_name": "session_abc123",
    "status": "manual_live",
    "assigned_agent": {
      "id": "agent_001",
      "name": "å°ç‹"
    }
  }
}
```

**çŠ¶æ€ç **:
- `200`: æ¥å…¥æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `409`: ä¼šè¯å·²è¢«å…¶ä»–åå¸­æ¥å…¥ (`ALREADY_TAKEN`)
- `409`: å½“å‰çŠ¶æ€ä¸å…è®¸æ¥å…¥ (`INVALID_STATUS`)
- `400`: ç¼ºå°‘å¿…éœ€å‚æ•°

**é˜²æŠ¢å•é€»è¾‘**:
- åªå…è®¸åœ¨ `pending_manual` çŠ¶æ€ä¸‹æ¥å…¥
- åŒä¸€ä¼šè¯åªèƒ½è¢«ä¸€ä¸ªåå¸­æ¥å…¥
- å·²æ¥å…¥çš„ä¼šè¯ä¼šè¿”å› 409 é”™è¯¯

### 11. æŸ¥è¯¢ä¼šè¯åˆ—è¡¨ âœ¨ **æ–°å¢**

è·å–ä¼šè¯åˆ—è¡¨ï¼Œæ”¯æŒæŒ‰çŠ¶æ€ç­›é€‰å’Œåˆ†é¡µã€‚

**è¯·æ±‚**:
```bash
# æŸ¥è¯¢ pending_manual çŠ¶æ€çš„ä¼šè¯
GET /api/sessions?status=pending_manual&limit=10&offset=0

# æŸ¥è¯¢æ‰€æœ‰ä¼šè¯
GET /api/sessions?limit=20&offset=0
```

**Query Parameters**:
- `status` (å¯é€‰): ä¼šè¯çŠ¶æ€ç­›é€‰ (`pending_manual`, `manual_live`, `bot_active` ç­‰)
- `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 50
- `offset` (å¯é€‰): åç§»é‡ï¼Œé»˜è®¤ 0

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "sessions": [
      {
        "session_name": "session_123",
        "status": "pending_manual",
        "user_profile": {
          "nickname": "è®¿å®¢A",
          "vip": true
        },
        "updated_at": 1763695256.744,
        "last_message_preview": {
          "role": "user",
          "content": "æˆ‘è¦äººå·¥",
          "timestamp": 1763695256.743
        },
        "escalation": {
          "reason": "keyword",
          "trigger_at": 1763695256.743,
          "waiting_seconds": 120.5
        },
        "assigned_agent": null
      }
    ],
    "total": 5,
    "limit": 10,
    "offset": 0,
    "has_more": false
  }
}
```

**è¯´æ˜**:
- è¿”å›æ‘˜è¦æ ¼å¼ï¼ŒåŒ…å«æœ€åä¸€æ¡æ¶ˆæ¯é¢„è§ˆ
- è‡ªåŠ¨è®¡ç®—ç­‰å¾…æ—¶é—´ (`waiting_seconds`)
- æŒ‰æ›´æ–°æ—¶é—´å€’åºæ’åˆ—

### 12. ä¼šè¯ç»Ÿè®¡ âœ¨ **æ–°å¢**

è·å–ä¼šè¯ç»Ÿè®¡ä¿¡æ¯ã€‚

**è¯·æ±‚**:
```bash
GET /api/sessions/stats
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "total_sessions": 50,
    "by_status": {
      "bot_active": 35,
      "pending_manual": 3,
      "manual_live": 2,
      "closed": 10
    },
    "active_sessions": 40,
    "avg_waiting_time": 45.67
  }
}
```

**è¯´æ˜**:
- `total_sessions`: æ€»ä¼šè¯æ•°
- `by_status`: å„çŠ¶æ€ä¼šè¯æ•°é‡
- `active_sessions`: æ´»è·ƒä¼šè¯æ•°ï¼ˆé closed çŠ¶æ€ï¼‰
- `avg_waiting_time`: å¹³å‡ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰

### 13. é‡Šæ”¾ä¼šè¯

ç»“æŸäººå·¥æ¥ç®¡ï¼Œå°†ä¼šè¯æ¢å¤ä¸ºAIæ¨¡å¼ã€‚

**è¯·æ±‚**:
```bash
POST /api/sessions/{session_name}/release
Content-Type: application/json

{
  "agent_id": "agent_01",
  "reason": "resolved"  # æˆ– "transferred", "timeout" ç­‰
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "session_name": "session_abc123",
    "status": "bot_active",
    "last_manual_end_at": 1763605100
  }
}
```

### 14. ä¿®æ”¹è‡ªå·±å¯†ç  â­ v3.1.2 æ–°å¢

åå¸­ä¿®æ”¹è‡ªå·±çš„å¯†ç ï¼ˆéœ€è¦åå¸­æƒé™ï¼‰ã€‚

**è¯·æ±‚**:
```bash
POST /api/agent/change-password
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "old_password": "agent123",
  "new_password": "newpass123"
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

**é”™è¯¯å“åº”**:
```json
{
  "detail": "OLD_PASSWORD_INCORRECT: æ—§å¯†ç ä¸æ­£ç¡®"
}
// æˆ–
{
  "detail": "INVALID_PASSWORD: å¯†ç å¿…é¡»è‡³å°‘8ä¸ªå­—ç¬¦ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—"
}
// æˆ–
{
  "detail": "PASSWORD_SAME: æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ"
}
```

**çº¦æŸ**:
- âœ… éœ€è¦éªŒè¯æ—§å¯†ç æ­£ç¡®æ€§
- âœ… æ–°å¯†ç å¿…é¡»è‡³å°‘8å­—ç¬¦ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—
- âœ… æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
- âš ï¸ ä¿®æ”¹å¯†ç åï¼Œæ—§çš„ Token ä»ç„¶æœ‰æ•ˆï¼ˆç›´åˆ°è¿‡æœŸï¼‰

### 15. ä¿®æ”¹ä¸ªäººèµ„æ–™ â­ v3.1.3 æ–°å¢

åå¸­ä¿®æ”¹è‡ªå·±çš„ä¸ªäººèµ„æ–™ï¼ˆéœ€è¦åå¸­æƒé™ï¼‰ã€‚

**è¯·æ±‚**:
```bash
PUT /api/agent/profile
Authorization: Bearer <access_token>
Content-Type: application/json

{
  "name": "æ–°å§“å",              // å¯é€‰ï¼Œ1-50å­—ç¬¦
  "avatar_url": "/avatars/new.png"  // å¯é€‰
}
```

**å“åº”**:
```json
{
  "success": true,
  "agent": {
    "id": "agent_1763973603632",
    "username": "agent001",
    "name": "æ–°å§“å",           // â† å·²æ›´æ–°
    "role": "agent",
    "status": "online",
    "max_sessions": 5,
    "created_at": 1763973603.8021133,
    "last_login": 1763973937.2624621,
    "avatar_url": "/avatars/new.png"  // â† å·²æ›´æ–°
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "detail": "NO_FIELDS_TO_UPDATE: è‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªè¦ä¿®æ”¹çš„å­—æ®µ"
}
```

**çº¦æŸ**:
- âœ… åªå…è®¸ä¿®æ”¹ `name` å’Œ `avatar_url` ä¸¤ä¸ªå­—æ®µ
- âŒ ç¦æ­¢ä¿®æ”¹ `role`ã€`username`ã€`max_sessions`ã€`status` ç­‰æ•æ„Ÿå­—æ®µ
- âœ… è‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªå­—æ®µï¼ˆname æˆ– avatar_urlï¼‰
- âœ… å¯ä»¥å•ç‹¬ä¿®æ”¹ nameï¼Œå•ç‹¬ä¿®æ”¹ avatar_urlï¼Œæˆ–åŒæ—¶ä¿®æ”¹ä¸¤è€…

---

## ğŸ”„ SSE å®æ—¶æ¨é€ (P0-5)

ç³»ç»Ÿæ”¯æŒé€šè¿‡ Server-Sent Events (SSE) å‘å‰ç«¯å®æ—¶æ¨é€äººå·¥æ¥ç®¡ç›¸å…³äº‹ä»¶ã€‚

### å·¥ä½œåŸç†

1. å‰ç«¯å»ºç«‹ `/api/chat/stream` é•¿è¿æ¥
2. åç«¯åœ¨ä»¥ä¸‹æƒ…å†µæ¨é€äº‹ä»¶ï¼š
   - äººå·¥å‡çº§æ—¶ â†’ æ¨é€ `status_change`
   - åå¸­å‘é€æ¶ˆæ¯æ—¶ â†’ æ¨é€ `manual_message`
   - ä¼šè¯é‡Šæ”¾æ—¶ â†’ æ¨é€ç³»ç»Ÿæ¶ˆæ¯ + `status_change`

### SSE äº‹ä»¶æ ¼å¼

**çŠ¶æ€å˜åŒ–äº‹ä»¶**:
```
data: {
  "type": "status_change",
  "status": "pending_manual",
  "reason": "user_request",
  "timestamp": 1763605000
}
```

**äººå·¥æ¶ˆæ¯äº‹ä»¶**:
```
data: {
  "type": "manual_message",
  "role": "agent",
  "content": "æ‚¨å¥½ï¼Œæˆ‘æ˜¯äººå·¥å®¢æœ",
  "timestamp": 1763605000,
  "agent_id": "agent_01",
  "agent_name": "å°ç‹"
}
```

**ç³»ç»Ÿæ¶ˆæ¯äº‹ä»¶**:
```
data: {
  "type": "manual_message",
  "role": "system",
  "content": "äººå·¥æœåŠ¡å·²ç»“æŸï¼ŒAI åŠ©æ‰‹å·²æ¥ç®¡å¯¹è¯",
  "timestamp": 1763605100
}
```

### å‰ç«¯æ¥æ”¶ç¤ºä¾‹

```javascript
const eventSource = new EventSource('/api/chat/stream');

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data);

  if (data.type === 'status_change') {
    console.log('çŠ¶æ€å˜åŒ–:', data.status);
    // æ›´æ–°UIæ˜¾ç¤ºçŠ¶æ€
  }

  if (data.type === 'manual_message') {
    console.log('æ”¶åˆ°æ¶ˆæ¯:', data.content);
    // æ˜¾ç¤ºæ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
  }
};
```

---

## ä¼šè¯éš”ç¦»æœºåˆ¶

æœ¬ç³»ç»Ÿå®ç°äº†åŸºäº `session_name` çš„å¤šç”¨æˆ·ä¼šè¯éš”ç¦»:

### å·¥ä½œåŸç†

```
å‰ç«¯è®¿é—® â†’ ç”Ÿæˆ session_id
    â†“
åç«¯æ¥æ”¶ user_id (session_id)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. JWT ç­¾ç½²æ—¶æ·»åŠ            â”‚
â”‚    jwt_payload["session_name"] = user_id
â”‚                             â”‚
â”‚ 2. API è¯·æ±‚æ—¶æ·»åŠ            â”‚
â”‚    api_payload["session_name"] = user_id
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ‰£å­å¹³å°æ ¹æ® session_name éš”ç¦»ä¼šè¯
```

### å…³é”®å®ç°

**JWT ç­¾ç½²** (`src/jwt_signer.py:117-118`):
```python
if session_name:
    payload["session_name"] = session_name
```

**API è¯·æ±‚** (`backend.py:324`):
```python
payload = {
    "workflow_id": WORKFLOW_ID,
    "app_id": APP_ID,
    "session_name": session_id,  # â† å…³é”®å­—æ®µ
    "parameters": {"USER_INPUT": message}
}
```

è¯¦ç»†å®ç°è¿‡ç¨‹è§ [ä¼šè¯éš”ç¦»å®ç°å†ç¨‹](docs/ä¼šè¯éš”ç¦»å®ç°å†ç¨‹.md)

---

## ğŸ§ª æµ‹è¯•

### å›å½’æµ‹è¯•å¥—ä»¶ï¼ˆæ¨èï¼‰

```bash
./tests/regression_test.sh
```

**æµ‹è¯•è¦†ç›–**ï¼š
- ç¬¬ä¸€å±‚ï¼šæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•ï¼ˆ3é¡¹ï¼‰
  - å¥åº·æ£€æŸ¥
  - AIå¯¹è¯ï¼ˆåŒæ­¥ï¼‰
  - ä¼šè¯éš”ç¦»ï¼ˆé¢„å…ˆåˆ›å»ºconversationï¼‰
- ç¬¬äºŒå±‚ï¼šäººå·¥æ¥ç®¡åŠŸèƒ½æµ‹è¯•ï¼ˆ5é¡¹ï¼‰
  - äººå·¥å‡çº§ã€AIé˜»æ­¢ã€åå¸­æ¥å…¥ã€å‘é€æ¶ˆæ¯ã€é‡Šæ”¾ä¼šè¯
- ç¬¬ä¸‰å±‚ï¼šåå¸­å·¥ä½œå°åŠŸèƒ½æµ‹è¯•ï¼ˆ4é¡¹ï¼‰
  - ä¼šè¯åˆ—è¡¨ã€ç»Ÿè®¡ä¿¡æ¯ã€TypeScriptæ£€æŸ¥ï¼ˆagent-workbench + frontendï¼‰

**é¢„æœŸç»“æœ**ï¼š12/12 é€šè¿‡

### å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8000/api/health
```

### ä¼šè¯éš”ç¦»æµ‹è¯•

**ç®€å•æµ‹è¯•**ï¼š
```bash
python3 tests/test_simple.py
```

**æµ‹è¯•å†…å®¹**:
- ç”¨æˆ· A: "æˆ‘å«å¼ ä¸‰"
- ç”¨æˆ· B: "æˆ‘å«æå››"
- ç”¨æˆ· A ç¬¬äºŒè½®: "æˆ‘å«ä»€ä¹ˆ?" â†’ æœŸæœ›å›ç­” "å¼ ä¸‰"

**å®Œæ•´ä¼šè¯éš”ç¦»æµ‹è¯•** â­ å·²ä¿®å¤ï¼š
```bash
python3 tests/test_session_name.py
```

**æµ‹è¯•æ­¥éª¤** (éµå¾ªæ­£ç¡®çš„ä¼šè¯éš”ç¦»å®ç°):
1. ç”¨æˆ·Aæ‰“å¼€é¡µé¢ â†’ ç«‹å³è°ƒç”¨ `/api/conversation/new` åˆ›å»º conversation_A
2. ç”¨æˆ·Bæ‰“å¼€é¡µé¢ â†’ ç«‹å³è°ƒç”¨ `/api/conversation/new` åˆ›å»º conversation_B
3. éªŒè¯ conversation_A â‰  conversation_B
4. ç”¨æˆ·Aè¯´ "æˆ‘å«å¼ ä¸‰ï¼Œæˆ‘ä»Šå¹´25å²"
5. ç”¨æˆ·Bè¯´ "æˆ‘å«æå››ï¼Œæˆ‘æ˜¯ä¸€åç¨‹åºå‘˜"
6. ç”¨æˆ·Aé—® "æˆ‘å«ä»€ä¹ˆï¼Ÿæˆ‘å¤šå¤§äº†ï¼Ÿ" â†’ æœŸæœ›å›ç­” "å¼ ä¸‰ã€25å²"
7. ç”¨æˆ·Bé—® "æˆ‘çš„åå­—å’ŒèŒä¸šæ˜¯ä»€ä¹ˆï¼Ÿ" â†’ æœŸæœ›å›ç­” "æå››ã€ç¨‹åºå‘˜"
8. **å…³é”®éªŒè¯**: ç”¨æˆ·Aé—® "ä½ çŸ¥é“æå››æ˜¯è°å—ï¼Ÿ" â†’ æœŸæœ›**ä¸çŸ¥é“**ï¼ˆè¯æ˜ä¼šè¯éš”ç¦»æˆåŠŸï¼‰

**æ³¨æ„**: æ­¤æµ‹è¯•è„šæœ¬å·²ä¿®å¤ï¼Œä¸¥æ ¼éµå¾ªã€ŠCozeä¼šè¯éš”ç¦»æœ€ç»ˆè§£å†³æ–¹æ¡ˆ.mdã€‹çš„å®ç°æ–¹å¼

---

## å¸¸è§é—®é¢˜

### Q: ä¼šè¯éš”ç¦»ä¸ç”Ÿæ•ˆæ€ä¹ˆåŠ?

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹:
1. ç¡®è®¤ `backend.py:324` æ·»åŠ äº† `"session_name": session_id`
2. ç¡®è®¤æµå¼æ¥å£ `backend.py:449` ä¹Ÿæ·»åŠ äº† session_name
3. è¿è¡Œæµ‹è¯•éªŒè¯: `python3 tests/test_simple.py`

### Q: æç¤º "COZE_WORKFLOW_ID ç¯å¢ƒå˜é‡æœªè®¾ç½®"?

**A**:
1. ç¡®è®¤ `.env` æ–‡ä»¶å­˜åœ¨
2. æ£€æŸ¥æ–‡ä»¶å†…å®¹æ˜¯å¦æ­£ç¡®
3. é‡å¯åç«¯æœåŠ¡

æ›´å¤šé—®é¢˜è§ [é…ç½®æŒ‡å—](docs/é…ç½®æŒ‡å—.md#å¸¸è§é—®é¢˜)

---

## æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI
- **HTTP å®¢æˆ·ç«¯**: httpx
- **JWT å¤„ç†**: PyJWT
- **AI å¹³å°**: Coze Workflow
- **é‰´æƒæ–¹å¼**: OAuth 2.0 + JWT

---

## ğŸ“š æ–‡æ¡£

- [CHANGELOG.md](CHANGELOG.md) - è¯¦ç»†æ›´æ–°æ—¥å¿— â­ æ–°å¢
- [å®Œæ•´æ€»ç»“.md](å®Œæ•´æ€»ç»“.md) - ä¸‰ä¸ªå‰ç«¯ç‰ˆæœ¬å®Œæ•´å¯¹æ¯” â­ æ–°å¢
- [ä½¿ç”¨è¯´æ˜-æœ€ç»ˆç‰ˆ.md](ä½¿ç”¨è¯´æ˜-æœ€ç»ˆç‰ˆ.md) - index2.html ä½¿ç”¨æŒ‡å— â­ æ–°å¢
- [frontend/README_CN.md](frontend/README_CN.md) - Vue 3 ç‰ˆæœ¬æ–‡æ¡£ â­ æ–°å¢
- [é…ç½®æŒ‡å—](docs/é…ç½®æŒ‡å—.md) - ç¯å¢ƒé…ç½®å’Œ Coze å¹³å°è®¾ç½®
- [ä¼šè¯éš”ç¦»å®ç°å†ç¨‹](docs/ä¼šè¯éš”ç¦»å®ç°å†ç¨‹.md) - ä»é—®é¢˜åˆ°è§£å†³çš„å®Œæ•´è¿‡ç¨‹

---
## ğŸ“Š ç‰ˆæœ¬å†å²

### v3.1.3 (2025-11-25) - P1 è‡ªåŠ©åŠŸèƒ½å…¨éƒ¨å®Œæˆ â­

**åŠŸèƒ½å®Œæˆåº¦**: 98% (æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œç”Ÿäº§ç¯å¢ƒå°±ç»ª)

**ä¸»è¦æ›´æ–°**:

**ğŸ”µ ä¿®æ”¹ä¸ªäººèµ„æ–™åŠŸèƒ½** (ADMIN-08)
- âœ… POST /api/agent/profile - åå¸­ä¿®æ”¹è‡ªå·±çš„ name å’Œ avatar_url
- âœ… å­—æ®µé™åˆ¶ï¼šåªå…è®¸ä¿®æ”¹éæ•æ„Ÿå­—æ®µ
- âœ… æµ‹è¯•ï¼š8/8 åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œ12/12 å›å½’æµ‹è¯•é€šè¿‡

**ğŸ› Bug ä¿®å¤**:
- âœ… ä¿®å¤ `/api/conversation/new` SSL è¶…æ—¶é—®é¢˜ï¼ˆæ·»åŠ  HTTP è¶…æ—¶å’Œä»£ç†é…ç½®ï¼‰
- âœ… ä¿®å¤ `/api/conversation/clear` SSL è¶…æ—¶é—®é¢˜

**GitHub**: Commit `0af51a9`, Tag `v3.1.3`

---

### v3.1.2 (2025-11-25) - P1 ä¿®æ”¹å¯†ç åŠŸèƒ½å®Œæˆ â­

**ä¸»è¦æ›´æ–°**:

**ğŸ”µ ä¿®æ”¹å¯†ç åŠŸèƒ½** (ADMIN-07)
- âœ… POST /api/agent/change-password - åå¸­ä¿®æ”¹è‡ªå·±çš„å¯†ç 
- âœ… éªŒè¯æ—§å¯†ç æ­£ç¡®æ€§
- âœ… æ–°å¯†ç å¼ºåº¦éªŒè¯ï¼ˆè‡³å°‘8å­—ç¬¦ï¼Œå«å­—æ¯å’Œæ•°å­—ï¼‰
- âœ… æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ
- âœ… æµ‹è¯•ï¼š6/7 åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œ12/12 å›å½’æµ‹è¯•é€šè¿‡

**æ–‡æ¡£æ›´æ–°**:
- æ›´æ–° `prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md` v2.7
- æ›´æ–° `prd/04_ä»»åŠ¡æ‹†è§£/admin_management_tasks.md` v1.2

**GitHub**: Commit `[hash]`, Tag `v3.1.2`

---

### v3.1.1 (2025-11-25) - ç®¡ç†å‘˜åŠŸèƒ½å®Œæˆ (P0) â­ é‡è¦æ›´æ–°

**ä¸»è¦æ›´æ–°**:

**ğŸ”´ JWT æƒé™ä¸­é—´ä»¶** (100%)
- âœ… verify_agent_token() - éªŒè¯ JWT Token
- âœ… require_admin() - ç®¡ç†å‘˜æƒé™ä¸­é—´ä»¶
- âœ… require_agent() - åå¸­æƒé™ä¸­é—´ä»¶
- âœ… ä¸‰å±‚æƒé™æ¨¡å‹ï¼šæ— è®¤è¯ / åå¸­ / ç®¡ç†å‘˜

**ğŸ”´ ç®¡ç†å‘˜ API** (5ä¸ªæ ¸å¿ƒæ¥å£)
- âœ… GET /api/agents - æŸ¥è¯¢åå¸­åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œè§’è‰²ç­›é€‰ï¼‰
- âœ… POST /api/agents - åˆ›å»ºåå¸­è´¦å·
- âœ… PUT /api/agents/{username} - ä¿®æ”¹åå¸­ä¿¡æ¯
- âœ… DELETE /api/agents/{username} - åˆ é™¤åå¸­è´¦å·
- âœ… POST /api/agents/{username}/reset-password - é‡ç½®å¯†ç 

**ğŸ› Bug ä¿®å¤**:
- âœ… ä¿®å¤ JWT Token æ—¶åŒºé—®é¢˜ï¼ˆUTC+8 å¯¼è‡´ Token ç«‹å³è¿‡æœŸï¼‰
- é—®é¢˜ï¼š`datetime.now()` ä½¿ç”¨æœ¬åœ°æ—¶åŒºï¼Œä½† JWT exp éœ€è¦ UTC
- è§£å†³ï¼šä½¿ç”¨ `datetime.now(timezone.utc)` ç¡®ä¿æ—¶åŒºä¸€è‡´

**ğŸ§ª æµ‹è¯•**:
- âœ… 7/7 ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… 12/12 å›å½’æµ‹è¯•é€šè¿‡

**æ–‡æ¡£æ›´æ–°**:
- æ›´æ–° `prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md` v2.6
- æ›´æ–° `prd/04_ä»»åŠ¡æ‹†è§£/admin_management_tasks.md` v1.1

**GitHub**: Commit `[hash]`, Tag `v3.1.1`

---

### v3.1.0 (2025-11-25) - Fiido E-bike ä¸šåŠ¡éœ€æ±‚æ•´åˆ v3.1 â­ P0 åŠŸèƒ½å®Œæˆ

**ä¸»è¦æ›´æ–°**:

**ğŸŒ UserProfile æ‰©å±•** (æ¬§æ´²è·¨å¢ƒä¸šåŠ¡éœ€æ±‚)
- âœ… GDPR åˆè§„å­—æ®µï¼ˆdata_consent, marketing_consentï¼‰
- âœ… å¤šè¯­è¨€æ”¯æŒï¼ˆpreferred_language: en/de/fr/es/it/nlï¼‰
- âœ… å¤šè´§å¸æ”¯æŒï¼ˆcurrency_preference: EUR/GBP/USDï¼‰
- âœ… å›½å®¶/åœ°åŒºå­—æ®µï¼ˆcountry, timezoneï¼‰

**ğŸ“Š ç»Ÿè®¡æ¥å£æ‰©å±•** (GET /api/sessions/stats)
- âœ… AI è´¨é‡æŒ‡æ ‡ï¼ˆai_accuracy_rate, avg_satisfactionï¼‰
- âœ… åå¸­æ•ˆç‡æŒ‡æ ‡ï¼ˆagent_response_time, agent_productivityï¼‰
- âœ… ä¸šåŠ¡æŒ‡æ ‡ï¼ˆtotal_escalations, resolution_rateï¼‰

**ğŸ“‹ åˆè§„æ€§è¯´æ˜**
- âœ… æ–°å¢ `prd/01_å…¨å±€æŒ‡å¯¼/PRD_COMPLETE_v3.0.md` åˆè§„æ€§ç« èŠ‚
- æ•°æ®ä¿æŠ¤ï¼ˆGDPR Article 6, 13, 15, 17ï¼‰
- EU ç”µæ± æ³•è§„ï¼ˆEU 2023/1542ï¼‰
- æ¶ˆè´¹è€…æƒç›Šä¿æŠ¤

**ğŸ“‚ å®æ–½æ–¹æ¡ˆæ–‡æ¡£**
- âœ… æ–°å¢ `docs/P2_å·¥å•ç³»ç»Ÿå®æ–½æ–¹æ¡ˆè¯¦è§£.md`
- âœ… æ–°å¢ `docs/P2_çŸ¥è¯†åº“ç³»ç»Ÿå®æ–½æ–¹æ¡ˆè¯¦è§£.md`

**GitHub**: Commit `09597f9`, Tag `v3.1.0`

---

### v2.3.6 (2025-11-24) - Redis æ•°æ®æŒä¹…åŒ–å®ç° ğŸ’¾

**åŠŸèƒ½å®Œæˆåº¦**: 95% (æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼Œç”Ÿäº§ç¯å¢ƒå°±ç»ª)

**ä¸»è¦æ›´æ–°**:

**ğŸ”´ Redis æ•°æ®æŒä¹…åŒ–** (100%) - è§£å†³ä¸‰å¤§é—®é¢˜
- âœ… **é—®é¢˜1 è§£å†³**ï¼šæœåŠ¡å™¨é‡å¯åæ•°æ®è‡ªåŠ¨æ¢å¤ï¼ˆä¸å†ä¸¢å¤±ï¼‰
- âœ… **é—®é¢˜2 è§£å†³**ï¼šæ”¯æŒæ°´å¹³æ‰©å±•ï¼ˆå¤šå°æœåŠ¡å™¨å…±äº« Redis æ•°æ®ï¼‰
- âœ… **é—®é¢˜3 è§£å†³**ï¼šæ”¯æŒå†å²æ•°æ®æŸ¥è¯¢å’Œå¯¼å‡º
- âœ… åˆ›å»º `src/redis_session_store.py` (406è¡Œ)
  - å®Œæ•´å®ç° SessionStateStore æ¥å£
  - è¿æ¥æ± ç®¡ç†ï¼ˆmax_connections=50ï¼‰
  - TTL è¿‡æœŸç­–ç•¥ï¼ˆ24å°æ—¶è‡ªåŠ¨æ¸…ç†ï¼‰
  - å¥åº·æ£€æŸ¥å’Œç›‘æ§åŠŸèƒ½
  - å®šæœŸæ¸…ç†ç­–ç•¥
- âœ… ä¿®æ”¹ `backend.py` é›†æˆ Redis
  - å®ç°é™çº§ç­–ç•¥ï¼ˆRedis å¤±è´¥æ—¶é™çº§åˆ°å†…å­˜å­˜å‚¨ï¼‰
  - å¯åŠ¨æ—¶æ˜¾ç¤º Redis å¥åº·çŠ¶æ€
  - æ”¯æŒç¯å¢ƒå˜é‡é…ç½®
- âœ… æ›´æ–° `.env` é…ç½®
  - æ–°å¢ 6 ä¸ª Redis é…ç½®é¡¹
  - è¯¦ç»†çš„æ³¨é‡Šå’Œç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

**ğŸ”’ çº¦æŸ16ï¼šç”Ÿäº§ç¯å¢ƒå®‰å…¨æ€§ä¸ç¨³å®šæ€§** (100%)
- âœ… æ–°å¢çº¦æŸæ–‡æ¡£ `prd/02_çº¦æŸä¸åŸåˆ™/CONSTRAINTS_AND_PRINCIPLES.md`
- âœ… èµ„æºç®¡ç†ä¸é™åˆ¶ï¼ˆ16.1ï¼‰
  - å­˜å‚¨é™åˆ¶ï¼šmaxmemory, TTL
  - æ—¥å¿—ç®¡ç†ï¼šæ—¥å¿—è½®è½¬
  - è¿æ¥æ± é™åˆ¶
- âœ… æ•°æ®æ¸…ç†ç­–ç•¥ï¼ˆ16.2ï¼‰
  - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
  - ç›‘æ§å­˜å‚¨ä½¿ç”¨é‡
- âœ… é”™è¯¯å¤„ç†ä¸é™çº§ï¼ˆ16.3ï¼‰
  - Redis ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§
  - è¶…æ—¶ä¿æŠ¤ï¼ˆ5ç§’ï¼‰
- âœ… å®‰å…¨æ€§è¦æ±‚ï¼ˆ16.4ï¼‰
  - æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
  - ç¯å¢ƒå˜é‡éš”ç¦»
  - è¾“å…¥éªŒè¯
- âœ… ç›‘æ§ä¸å‘Šè­¦ï¼ˆ16.5ï¼‰
  - å…³é”®æŒ‡æ ‡ç›‘æ§
  - å¥åº·æ£€æŸ¥ç«¯ç‚¹
- âœ… ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•ï¼ˆ16.6ï¼‰

**ğŸ§ª æµ‹è¯•éªŒè¯** (100%)
- âœ… åˆ›å»º `tests/test_redis_persistence.py`
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼š
  - æ•°æ®ä¿å­˜æˆåŠŸ
  - æ•°æ®è¯»å–æˆåŠŸ
  - æ•°æ®å®Œæ•´æ€§éªŒè¯
  - æœåŠ¡å™¨é‡å¯åæ•°æ®æ¢å¤
  - å†å²æ¶ˆæ¯å®Œæ•´ä¿ç•™
  - ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ¢å¤

**å½“å‰ç³»ç»ŸåŠŸèƒ½**:
- âœ… AI æ™ºèƒ½å¯¹è¯ - åŸºäº Coze Workflow
- âœ… äººå·¥æ¥ç®¡æµç¨‹ - 5 ç§çŠ¶æ€ç®¡ç†
- âœ… åå¸­å·¥ä½œå° - å®Œæ•´å·¥ä½œå°å®ç°
- âœ… å®æ—¶æ¶ˆæ¯æ¨é€ - SSE é•¿è¿æ¥
- âœ… ä¼šè¯éš”ç¦» - åŸºäº session_name
- âœ… å†å²å›å¡« - åˆ·æ–°ä¿æŒä¸Šä¸‹æ–‡
- âœ… å“ç‰Œè®¾è®¡ - Fiido å®˜æ–¹é£æ ¼
- âœ… å±€åŸŸç½‘è®¿é—® - æ”¯æŒå¤šè®¾å¤‡è®¿é—®
- âœ… **Redis æ•°æ®æŒä¹…åŒ–** - æœåŠ¡å™¨é‡å¯ä¸ä¸¢å¤±æ•°æ® â­ æ–°å¢
- âœ… **æ°´å¹³æ‰©å±•æ”¯æŒ** - å¤šå°æœåŠ¡å™¨å…±äº«æ•°æ® â­ æ–°å¢

**ç”Ÿäº§ç¯å¢ƒå°±ç»ª**:
- âœ… æ•°æ®æŒä¹…åŒ–æœºåˆ¶
- âœ… é™çº§ç­–ç•¥
- âœ… èµ„æºé™åˆ¶
- âœ… ç›‘æ§å‘Šè­¦
- âœ… å®‰å…¨æ€§ä¿éšœ

**ä¸‹ä¸€æ­¥**: åå¸­è®¤è¯ç³»ç»Ÿï¼ˆJWTï¼‰ â†’ HTTPS éƒ¨ç½²

**GitHub**:
- Commit: `2054341`
- Tag: `v2.3.6`
- Files: 9 files changed

---

### v2.3.5 (2025-11-24) - å¼€å‘æµç¨‹è§„èŒƒå®Œå–„

**ä¸»è¦æ›´æ–°**:
- æ–°å¢"å…¨æ–°åŠŸèƒ½æ–¹æ¡ˆæ–‡æ¡£"å¼ºåˆ¶è¦æ±‚ï¼ˆCLAUDE.mdï¼‰
- åˆ›å»º Redis æ•°æ®æŒä¹…åŒ–æ–¹æ¡ˆæ–‡æ¡£

**GitHub**: Commit `85a8c80`, Tag `v2.3.5`

---

### v2.3.4 (2025-11-24) - æ–‡æ¡£ç»“æ„ä¼˜åŒ–
- é‡ç»„ prd/ å’Œ docs/ ç›®å½•ç»“æ„
- åˆ›å»ºæ–‡æ¡£ç´¢å¼•å’Œå¯¼èˆª
- **GitHub**: Commit `b4b90d2`, Tag `v2.3.4`

---

### v2.3.3 (2025-11-24) - UI ç¾åŒ–ä¸å“ç‰Œå‡çº§
- åå¸­å·¥ä½œå° Fiido å“ç‰Œè®¾è®¡
- ç”¨æˆ·ç«¯äººå·¥æ¥ç®¡ UI å®Œå–„
- ç½‘ç»œè®¿é—®é…ç½®ä¼˜åŒ–
- **GitHub**: Commit `ab42735`, Tag `v2.3.3`

---

### v2.3.2 (2025-11-23) - åå¸­å·¥ä½œå°å®Œå–„
- P0-12 è‡³ P0-15: åå¸­å·¥ä½œå°æ ¸å¿ƒåŠŸèƒ½
- P1-1: ä¼šè¯ç»Ÿè®¡ API
- P1-2: å†å²å›å¡«åŠŸèƒ½
- å›å½’æµ‹è¯•æ¡†æ¶ï¼ˆ12é¡¹è‡ªåŠ¨åŒ–æµ‹è¯•ï¼‰
- **GitHub**: Tag `v2.3.2`

---

### v2.3.1 (2025-11-22) - Coze Workflow ID æ›´æ–°
- æ›´æ–° Workflow ID è‡³æœ€æ–°ç‰ˆæœ¬
- ä¿®å¤å‰ç«¯å®¢æœå¤´åƒåŠ è½½é—®é¢˜
- **GitHub**: Tag `v2.3.1`

---

### v2.3.0 (2025-11-21) - P0äººå·¥æ¥ç®¡åŠŸèƒ½å®Œæˆ
- P0-4: æ ¸å¿ƒAPIå®ç°ï¼ˆäººå·¥å‡çº§ã€ä¼šè¯çŠ¶æ€ã€æ¶ˆæ¯å†™å…¥ã€é‡Šæ”¾ï¼‰
- P0-5: SSEå®æ—¶æ¨é€
- P0-6: JSONæ—¥å¿—è§„èŒƒ
- **GitHub**: Tag `v2.3.0`

---

### v2.2.1 (2025-11-20) - UIèœå•äº¤äº’ä¿®å¤
- ä¿®å¤æ°”æ³¡èœå•äº¤äº’é—®é¢˜
- **GitHub**: Tag `v2.2.1`

---

### v2.2.0 (2025-11-20) - ä¼šè¯éš”ç¦»é‡å¤§çªç ´
- å½»åº•è§£å†³ä¼šè¯éš”ç¦»é—®é¢˜
- å‰ç«¯UIä¼˜åŒ–ï¼ˆæ°”æ³¡èœå•ã€æ¸…é™¤å¯¹è¯ã€æ–°å»ºä¼šè¯ï¼‰
- **GitHub**: Tag `v2.2.0`

---

### v2.1.0 (2025-11-19) - ä¸‰å‰ç«¯ç‰ˆæœ¬å‘å¸ƒ
- åç«¯æ–°å¢å¤šä¸ªAPIæ¥å£
- ä¸‰ä¸ªå‰ç«¯ç‰ˆæœ¬ï¼šVue 3ã€Chat SDKã€å¢å¼ºç‰ˆHTML
- å®Œå…¨å¤åˆ» Fiido.com è®¾è®¡
- **GitHub**: Tag `v2.1.0`

---

ğŸ“– **è¯¦ç»†ç‰ˆæœ¬å†å²**: è§ [CHANGELOG_DETAIL.md](./CHANGELOG_DETAIL.md)

---

## v2.0.0 ä¹‹å‰çš„ç‰ˆæœ¬

### v2.0.0 (2025-11-18) - ä¼šè¯éš”ç¦»å®ç°
- å®ç°åŸºäº session_name çš„ä¼šè¯éš”ç¦»
- åŒé‡æ·»åŠ  session_name (JWT + API payload)
- å®Œæ•´çš„æµ‹è¯•éªŒè¯

---

**æœ€åæ›´æ–°**: 2025-11-25
**å½“å‰ç‰ˆæœ¬**: v3.1.3

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

## ğŸ“„ è®¸å¯è¯

MIT License

---

Made with â¤ï¸ by Claude Code
