# Coze ä¼šè¯éš”ç¦»æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰

**é¡¹ç›®**: Fiido æ™ºèƒ½å®¢æœç³»ç»Ÿ
**é—®é¢˜**: ä¸åŒæµè§ˆå™¨çª—å£/æ ‡ç­¾é¡µçš„ç”¨æˆ·å¯¹è¯å†…å®¹äº’ç›¸æ³„éœ²
**è§£å†³æ—¶é—´**: 2025-11-20
**éªŒè¯çŠ¶æ€**: âœ… å·²éªŒè¯é€šè¿‡ï¼Œå®é™…æµ‹è¯•å®Œå…¨ç”Ÿæ•ˆ

---

## ğŸ“‹ ç›®å½•

- [é—®é¢˜ç°è±¡](#é—®é¢˜ç°è±¡)
- [é—®é¢˜åˆ†æè¿‡ç¨‹](#é—®é¢˜åˆ†æè¿‡ç¨‹)
- [æ ¹æœ¬åŸå› ](#æ ¹æœ¬åŸå› )
- [æœ€ç»ˆè§£å†³æ–¹æ¡ˆ](#æœ€ç»ˆè§£å†³æ–¹æ¡ˆ)
- [å®ç°ç»†èŠ‚](#å®ç°ç»†èŠ‚)
- [éªŒè¯ç»“æœ](#éªŒè¯ç»“æœ)
- [æµ‹è¯•æ­¥éª¤](#æµ‹è¯•æ­¥éª¤)

---

## é—®é¢˜ç°è±¡

### ç”¨æˆ·æŠ¥å‘Š

æ‰“å¼€ä¸¤ä¸ªæµè§ˆå™¨çª—å£æµ‹è¯•ä¼šè¯éš”ç¦»ï¼š

1. **çª—å£ 1**: å‘é€æ¶ˆæ¯ "æˆ‘æ˜¯å­è±ª"
2. **çª—å£ 2**: å‘é€æ¶ˆæ¯ "æˆ‘æ˜¯è°ï¼Ÿ"
3. **âŒ é”™è¯¯ç»“æœ**: AI å›ç­” "ä½ æ˜¯å­è±ª"

**é¢„æœŸè¡Œä¸º**: çª—å£ 2 ä¸­ AI åº”è¯¥ä¸çŸ¥é“ "ä½ æ˜¯å­è±ª"ï¼Œå› ä¸ºè¿™æ˜¯ä¸åŒçš„ç”¨æˆ·ä¼šè¯ã€‚

### åˆæ­¥æ£€æŸ¥

é€šè¿‡æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12 â†’ Consoleï¼‰æ£€æŸ¥ï¼Œå‘ç°ï¼š

**çª—å£ 1 çš„ session_id**:
```
ğŸ†• ç”Ÿæˆæ–°ä¼šè¯ ID: session_1763604692993_7dxuzxj3qup_0wbs7j91lkk
```

**çª—å£ 2 çš„ session_id**:
```
ğŸ†• ç”Ÿæˆæ–°ä¼šè¯ ID: session_1763604677931_t96o9tlyh8m_0xqayqllv14
```

**çª—å£ 3 çš„ session_id**:
```
ğŸ†• ç”Ÿæˆæ–°ä¼šè¯ ID: session_1763604768897_7lv1hs0c4b5_7zwqss2iaev
```

âœ… **å‰ç«¯ session_id å®Œå…¨ä¸åŒ** - è¯´æ˜å‰ç«¯éš”ç¦»æœºåˆ¶æ­£å¸¸å·¥ä½œã€‚

---

## é—®é¢˜åˆ†æè¿‡ç¨‹

### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥åç«¯æ—¥å¿—

æŸ¥çœ‹åç«¯è¾“å‡ºï¼Œå‘ç°å…³é”®ä¿¡æ¯ï¼š

```
ğŸ” æµå¼ä¼šè¯éš”ç¦»: session_name=session_1763604677931_t96o9tlyh8m_0xqayqllv14
ğŸ†• æµå¼æ¥å£é¦–æ¬¡å¯¹è¯,å°†è‡ªåŠ¨ç”Ÿæˆ conversation_id
âœ… æµå¼æ¥å£ä¿å­˜æ–° conversation: 7572584214371631109 (session: session_1763604677931_t96o9tlyh8m_0xqayqllv14)

ğŸ” æµå¼ä¼šè¯éš”ç¦»: session_name=session_1763604692993_7dxuzxj3qup_0wbs7j91lkk
ğŸ†• æµå¼æ¥å£é¦–æ¬¡å¯¹è¯,å°†è‡ªåŠ¨ç”Ÿæˆ conversation_id
âœ… æµå¼æ¥å£ä¿å­˜æ–° conversation: 7572584214371631109 (session: session_1763604692993_7dxuzxj3qup_0wbs7j91lkk)

ğŸ” æµå¼ä¼šè¯éš”ç¦»: session_name=session_1763604768897_7lv1hs0c4b5_7zwqss2iaev
ğŸ†• æµå¼æ¥å£é¦–æ¬¡å¯¹è¯,å°†è‡ªåŠ¨ç”Ÿæˆ conversation_id
âœ… æµå¼æ¥å£ä¿å­˜æ–° conversation: 7572584214371631109 (session: session_1763604768897_7lv1hs0c4b5_7zwqss2iaev)
```

**ğŸš¨ å…³é”®å‘ç°**ï¼š
- ä¸‰ä¸ªä¸åŒçš„ `session_name`ï¼ˆåç«¯æ­£ç¡®ä¼ é€’ï¼‰
- ä½† Coze API è¿”å›äº†**ç›¸åŒçš„ `conversation_id`**: `7572584214371631109`
- è¿™å¯¼è‡´æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä¸ªå¯¹è¯ä¸Šä¸‹æ–‡ï¼

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥ä»£ç å®ç°

æŸ¥çœ‹åç«¯ä»£ç  `backend.py:657-820`ï¼Œæµå¼æ¥å£çš„å®ç°é€»è¾‘ï¼š

```python
# åç«¯ä»£ç ç‰‡æ®µ
async def chat_stream(request: ChatRequest):
    # è·å– session_id
    session_id = request.user_id or generate_user_id()

    # ç”Ÿæˆå¸¦ session_name çš„ token
    access_token = token_manager.get_access_token(session_name=session_id)

    # è·å– conversation_id
    conversation_id = request.conversation_id

    if not conversation_id:
        # æ£€æŸ¥ç¼“å­˜
        conversation_id = conversation_cache.get(session_id)

        if not conversation_id:
            print(f"ğŸ†• é¦–æ¬¡å¯¹è¯,å°†è‡ªåŠ¨ç”Ÿæˆ conversation_id")
            # âŒ é—®é¢˜ï¼šä¾èµ– Coze è‡ªåŠ¨ç”Ÿæˆï¼Œä½† Coze å¯èƒ½è¿”å›ç›¸åŒçš„ ID
```

**é—®é¢˜å®šä½**ï¼š
- å‰ç«¯é¦–æ¬¡å‘é€æ¶ˆæ¯æ—¶ï¼Œä¸ä¼  `conversation_id`
- åç«¯ä¹Ÿæ²¡æœ‰ç¼“å­˜çš„ `conversation_id`
- ä¾èµ– Coze API åœ¨å“åº”ä¸­è‡ªåŠ¨è¿”å› `conversation_id`
- **ä½† Coze å³ä½¿æ”¶åˆ°ä¸åŒçš„ `session_name`ï¼Œä»ç„¶å¯èƒ½è¿”å›ç›¸åŒçš„ `conversation_id`**

### ç¬¬ä¸‰æ­¥ï¼šç”¨æˆ·æå‡ºçš„è§£å†³æ€è·¯

ç”¨æˆ·æå‡ºå…³é”®é—®é¢˜ï¼š

> "æ˜¯å¦åœ¨ç”¨æˆ·åˆšè¿›æ¥æ—¶ï¼Œå…ˆè°ƒç”¨åˆ›å»ºä¼šè¯æ¥å£ï¼Œå¯ä»¥ç”ŸæˆåŠ¨æ€ conversation_idï¼Œåé¢ä¸€ç›´ç»™ coze ä¼ è¿™ä¸ª idï¼Œå°±ä¼šå¯¼è‡´ coze æ¥æ”¶åˆ°çš„ id ä¸åŒï¼Œä»è€Œè¿”å›çš„ä¸åŒï¼Ÿ"

**ğŸ’¡ è¿™ä¸ªæ€è·¯å®Œå…¨æ­£ç¡®ï¼**

---

## æ ¹æœ¬åŸå› 

### Coze API çš„è¡Œä¸ºç‰¹æ€§

æ ¹æ®å®é™…æµ‹è¯•å’Œæ—¥å¿—åˆ†æï¼Œå‘ç° Coze API æœ‰ä»¥ä¸‹è¡Œä¸ºï¼š

1. **é¦–æ¬¡å¯¹è¯ä¸ä¼  conversation_id æ—¶**ï¼š
   - Coze ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª `conversation_id`
   - ä½†å³ä½¿ä¼ å…¥äº†ä¸åŒçš„ `session_name`
   - **Coze ä»ç„¶å¯èƒ½è¿”å›ç›¸åŒçš„ `conversation_id`**

2. **ä½¿ç”¨ Coze SDK çš„ `conversations.create()` æ¥å£æ—¶**ï¼š
   - æ˜¾å¼è°ƒç”¨åˆ›å»ºæ¥å£ + ä¼ å…¥å¸¦ `session_name` çš„ token
   - **Coze ä¼šä¸ºæ¯ä¸ª session åˆ›å»ºç‹¬ç«‹çš„ conversation**
   - è¿”å›å®Œå…¨ä¸åŒçš„ `conversation_id`

### ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

**æ¨æµ‹åŸå› **ï¼ˆåŸºäºè§‚å¯Ÿåˆ°çš„è¡Œä¸ºï¼‰ï¼š

1. **é™æ€ä¼šè¯ç»‘å®š**ï¼š
   - Coze å·¥ä½œæµå¯èƒ½å†…éƒ¨ç»‘å®šäº†é™æ€ä¼šè¯
   - å¯¼è‡´é¦–æ¬¡å¯¹è¯æ—¶ï¼Œå³ä½¿ `session_name` ä¸åŒ
   - ä»ç„¶å…³è”åˆ°åŒä¸€ä¸ªåº•å±‚ä¼šè¯èµ„æº

2. **éšå¼ conversation å¤ç”¨**ï¼š
   - åœ¨é¦–æ¬¡å¯¹è¯è‡ªåŠ¨ç”Ÿæˆ `conversation_id` æ—¶
   - Coze å¯èƒ½åŸºäºæŸç§å†…éƒ¨é€»è¾‘å¤ç”¨å·²å­˜åœ¨çš„ conversation
   - è€Œä¸æ˜¯ä¸ºæ¯ä¸ª `session_name` åˆ›å»ºæ–°çš„ conversation

3. **æ˜¾å¼åˆ›å»ºæ‰èƒ½ä¿è¯éš”ç¦»**ï¼š
   - åªæœ‰é€šè¿‡ `conversations.create()` API æ˜¾å¼åˆ›å»º
   - å¹¶ä¸”ä½¿ç”¨å¸¦æ­£ç¡® `session_name` çš„ token
   - æ‰èƒ½ç¡®ä¿ Coze ä¸ºæ¯ä¸ª session åˆ†é…ç‹¬ç«‹çš„ conversation èµ„æº

---

## æœ€ç»ˆè§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

**åœ¨ç”¨æˆ·æ‰“å¼€é¡µé¢æ—¶ï¼Œç«‹å³è°ƒç”¨åˆ›å»ºä¼šè¯æ¥å£**ï¼Œé¢„å…ˆç”Ÿæˆå”¯ä¸€çš„ `conversation_id`ï¼Œç„¶ååœ¨æ‰€æœ‰åç»­å¯¹è¯ä¸­ä½¿ç”¨è¿™ä¸ª IDã€‚

### å®ç°åŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ· A æ‰“å¼€é¡µé¢                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. å‰ç«¯ç”Ÿæˆ session_id: session_xxx_A                       â”‚
â”‚ 2. ç«‹å³è°ƒç”¨ /api/conversation/new                           â”‚
â”‚ 3. åç«¯ä½¿ç”¨å¸¦ session_name çš„ token è°ƒç”¨                    â”‚
â”‚    conversations.create()                                   â”‚
â”‚ 4. Coze è¿”å› conversation_id: conv_111                     â”‚
â”‚ 5. å‰ç«¯ä¿å­˜ conversation_id åˆ°å†…å­˜                          â”‚
â”‚ 6. åç»­æ‰€æœ‰å¯¹è¯æºå¸¦ conversation_id: conv_111              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ· B æ‰“å¼€é¡µé¢                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. å‰ç«¯ç”Ÿæˆ session_id: session_xxx_B                       â”‚
â”‚ 2. ç«‹å³è°ƒç”¨ /api/conversation/new                           â”‚
â”‚ 3. åç«¯ä½¿ç”¨å¸¦ session_name çš„ token è°ƒç”¨                    â”‚
â”‚    conversations.create()                                   â”‚
â”‚ 4. Coze è¿”å› conversation_id: conv_222  â† ä¸åŒï¼           â”‚
â”‚ 5. å‰ç«¯ä¿å­˜ conversation_id åˆ°å†…å­˜                          â”‚
â”‚ 6. åç»­æ‰€æœ‰å¯¹è¯æºå¸¦ conversation_id: conv_222              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»“æœ: Coze æ”¶åˆ°ä¸åŒçš„ conversation_idï¼Œè¿”å›å®Œå…¨éš”ç¦»çš„ä¸Šä¸‹æ–‡
```

### å…³é”®ç‚¹

1. âœ… **ä¸»åŠ¨åˆ›å»ºè€Œéè¢«åŠ¨ç­‰å¾…**ï¼šä¸ä¾èµ–é¦–æ¬¡å¯¹è¯æ—¶ Coze è‡ªåŠ¨ç”Ÿæˆ
2. âœ… **ä½¿ç”¨ SDK çš„ create() æ¥å£**ï¼šæ˜¾å¼åˆ›å»º conversation èµ„æº
3. âœ… **ä¼ å…¥æ­£ç¡®çš„ session_name token**ï¼šç¡®ä¿ Coze ç»‘å®šåˆ°æ­£ç¡®çš„ä¼šè¯
4. âœ… **å‰ç«¯é¢„å…ˆåˆå§‹åŒ–**ï¼šé¡µé¢åŠ è½½æ—¶ç«‹å³åˆ›å»ºï¼Œè€Œéé¦–æ¬¡å‘æ¶ˆæ¯æ—¶æ‰åˆ›å»º

---

## å®ç°ç»†èŠ‚

### å‰ç«¯ä¿®æ”¹

**æ–‡ä»¶**: `frontend/src/components/ChatPanel.vue`

**æ–°å¢ä»£ç **ï¼ˆè¡Œå·ï¼š220-255ï¼‰ï¼š

```typescript
// Initialize conversation on mount
const initializeConversation = async () => {
  try {
    console.log('ğŸ”„ åˆå§‹åŒ–ä¼šè¯...')

    const response = await fetch(`${API_BASE_URL.value}/api/conversation/new`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ session_id: chatStore.sessionId })
    })

    const data = await response.json()

    if (data.success && data.conversation_id) {
      chatStore.setConversationId(data.conversation_id)
      console.log('âœ… ä¼šè¯åˆå§‹åŒ–æˆåŠŸ, Conversation ID:', data.conversation_id)
    } else {
      console.error('âš ï¸  ä¼šè¯åˆå§‹åŒ–å¤±è´¥:', data)
    }
  } catch (error) {
    console.error('âŒ ä¼šè¯åˆå§‹åŒ–å¼‚å¸¸:', error)
  }
}

// Handle product inquiry from other components
onMounted(() => {
  window.addEventListener('ask-product', ((e: CustomEvent) => {
    chatInput.value = `è¯·ä»‹ç»ä¸€ä¸‹ ${e.detail} çš„è¯¦ç»†ä¿¡æ¯`
    sendMessage()
  }) as EventListener)

  // Load bot config
  loadBotConfig()

  // âœ… Initialize conversation immediately
  initializeConversation()
})
```

**è¯´æ˜**ï¼š
- åœ¨ `onMounted()` ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­è°ƒç”¨ `initializeConversation()`
- é¡µé¢åŠ è½½åç«‹å³åˆ›å»º conversation
- å°†è¿”å›çš„ `conversation_id` ä¿å­˜åˆ° Pinia store
- åç»­æ‰€æœ‰å¯¹è¯è‡ªåŠ¨æºå¸¦è¿™ä¸ª `conversation_id`

### åç«¯æ¥å£

**æ–‡ä»¶**: `backend.py`
**æ¥å£**: `/api/conversation/new`ï¼ˆè¡Œå·ï¼š304-357ï¼‰

**å®ç°ä»£ç **ï¼š

```python
@app.post("/api/conversation/new")
async def create_new_conversation(request: dict):
    """
    åˆ›å»ºæ–°å¯¹è¯ (ä½¿ç”¨ Python SDK)
    ä¿æŒ session_id ä¸å˜,ä½†åˆ›å»ºæ–°çš„ conversation

    ã€Coze API çº¦æŸã€‘
    - ä¸¥æ ¼éµå®ˆ PRD 12.1.1: ä¸æ‰‹åŠ¨ç”Ÿæˆ conversation_idï¼Œç”± Coze è‡ªåŠ¨ç”Ÿæˆ
    - å¿…é¡»ä¼ å…¥ session_name å®ç°ä¼šè¯éš”ç¦»
    """
    global conversation_cache

    session_id = request.get("session_id")

    if not session_id:
        raise HTTPException(status_code=400, detail="session_id is required")

    if not jwt_oauth_app:
        raise HTTPException(status_code=503, detail="JWTOAuthApp æœªåˆå§‹åŒ–")

    try:
        # ä½¿ç”¨ JWTOAuthApp ç”Ÿæˆå¸¦ session_name çš„ token
        token_response = jwt_oauth_app.get_access_token(
            ttl=3600,
            session_name=session_id  # ã€Coze çº¦æŸã€‘ä¼šè¯éš”ç¦»å…³é”®
        )

        # æå– access_token
        access_token = token_response.access_token if hasattr(token_response, 'access_token') else token_response

        # ä½¿ç”¨ Python SDK åˆ›å»º Coze å®¢æˆ·ç«¯
        temp_coze = Coze(
            auth=TokenAuth(token=access_token),
            base_url=os.getenv("COZE_API_BASE", "https://api.coze.com")
        )

        # ã€Coze çº¦æŸã€‘åˆ›å»ºæ–° conversationï¼ˆç”± Coze è‡ªåŠ¨ç”Ÿæˆ IDï¼‰
        conversation = temp_coze.conversations.create()

        # æ›´æ–°ç¼“å­˜ï¼šä¿å­˜æ–°çš„ conversation_id
        conversation_cache[session_id] = conversation.id

        print(f"âœ… æ–°å¯¹è¯å·²åˆ›å»º: {conversation.id} (session: {session_id})")

        return {
            "success": True,
            "conversation_id": conversation.id
        }
    except Exception as e:
        print(f"âŒ åˆ›å»ºå¯¹è¯å¤±è´¥: {str(e)}")
        return {
            "success": False,
            "error": str(e)
        }
```

**å…³é”®æ­¥éª¤**ï¼š
1. æ¥æ”¶å‰ç«¯ä¼ æ¥çš„ `session_id`
2. ä½¿ç”¨ `jwt_oauth_app.get_access_token(session_name=session_id)` ç”Ÿæˆå¸¦ä¼šè¯ä¿¡æ¯çš„ token
3. åˆ›å»ºä¸´æ—¶ Coze å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨è¯¥ tokenï¼‰
4. è°ƒç”¨ `temp_coze.conversations.create()` åˆ›å»º conversation
5. å°† `conversation.id` ä¿å­˜åˆ°ç¼“å­˜å¹¶è¿”å›ç»™å‰ç«¯

---

## éªŒè¯ç»“æœ

### æµ‹è¯•æ•°æ®å¯¹æ¯”

#### âŒ ä¿®å¤å‰ï¼ˆæœªé¢„å…ˆåˆ›å»º conversationï¼‰

åç«¯æ—¥å¿—æ˜¾ç¤ºï¼šä¸‰ä¸ªä¸åŒçš„ `session_name`ï¼Œä½† Coze è¿”å›äº†**ç›¸åŒçš„ `conversation_id`**ï¼š

```
Session: session_1763604677931_t96o9tlyh8m_0xqayqllv14
â†’ Conversation: 7572584214371631109  â† ç›¸åŒ

Session: session_1763604692993_7dxuzxj3qup_0wbs7j91lkk
â†’ Conversation: 7572584214371631109  â† ç›¸åŒ

Session: session_1763604768897_7lv1hs0c4b5_7zwqss2iaev
â†’ Conversation: 7572584214371631109  â† ç›¸åŒ
```

**ç»“æœ**ï¼šâŒ ä¼šè¯éš”ç¦»å¤±è´¥ï¼ŒAI çŸ¥é“æ‰€æœ‰ç”¨æˆ·çš„å¯¹è¯å†…å®¹

#### âœ… ä¿®å¤åï¼ˆé¢„å…ˆè°ƒç”¨åˆ›å»ºæ¥å£ï¼‰

åç«¯æ—¥å¿—æ˜¾ç¤ºï¼šä¸‰ä¸ªä¸åŒçš„ `session_name`ï¼Œç”Ÿæˆäº†**å®Œå…¨ä¸åŒçš„ `conversation_id`**ï¼š

```
Session: session_1763604692993_7dxuzxj3qup_0wbs7j91lkk
â†’ Conversation: 7574615036068397061  â† ä¸åŒ

Session: session_1763604677931_t96o9tlyh8m_0xqayqllv14
â†’ Conversation: 7574617557825863685  â† ä¸åŒ

Session: session_1763604768897_7lv1hs0c4b5_7zwqss2iaev
â†’ Conversation: 7574616000908738565  â† ä¸åŒ
```

**ç»“æœ**ï¼šâœ… ä¼šè¯å®Œå…¨éš”ç¦»ï¼Œæ¯ä¸ªç”¨æˆ·æ‹¥æœ‰ç‹¬ç«‹çš„å¯¹è¯ä¸Šä¸‹æ–‡

### API æ¥å£æµ‹è¯•

ä½¿ç”¨ curl æµ‹è¯•åç«¯æ¥å£ï¼š

```bash
# æµ‹è¯•ä¼šè¯ A
$ curl -X POST http://localhost:8000/api/conversation/new \
  -H "Content-Type: application/json" \
  -d '{"session_id": "test_init_A"}'

{"success": true, "conversation_id": "7574620739060383749"}

# æµ‹è¯•ä¼šè¯ C
$ curl -X POST http://localhost:8000/api/conversation/new \
  -H "Content-Type: application/json" \
  -d '{"session_id": "test_init_C"}'

{"success": true, "conversation_id": "7574620850663194629"}
```

**éªŒè¯**ï¼šâœ… ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„ `conversation_id`

### æµè§ˆå™¨å®é™…æµ‹è¯•

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- åç«¯ï¼šhttp://localhost:8000
- å‰ç«¯ï¼šhttp://localhost:5173
- æµè§ˆå™¨ï¼šChrome / Firefox

**æµ‹è¯•æ­¥éª¤**ï¼š
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰
2. æ‰“å¼€çª—å£ 1ï¼šå‘é€ "æˆ‘æ˜¯å­è±ª"
3. æ‰“å¼€çª—å£ 2ï¼ˆæ— ç—•æ¨¡å¼ï¼‰ï¼šå‘é€ "æˆ‘æ˜¯è°ï¼Ÿ"

**å®é™…ç»“æœ**ï¼š
- çª—å£ 1ï¼šAI ç¡®è®¤ "ä½ å¥½ï¼Œå­è±ª"
- çª—å£ 2ï¼šAI å›å¤ "æˆ‘ä¸çŸ¥é“æ‚¨çš„åå­—ï¼Œè¯·é—®æ‚¨æ˜¯è°ï¼Ÿ"

âœ… **ä¼šè¯å®Œå…¨éš”ç¦»ï¼Œæµ‹è¯•é€šè¿‡ï¼**

---

## æµ‹è¯•æ­¥éª¤

### å‡†å¤‡å·¥ä½œ

1. **ç¡®ä¿æœåŠ¡æ­£åœ¨è¿è¡Œ**ï¼š

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨åç«¯
python3 backend.py

# ç»ˆç«¯ 2ï¼šå¯åŠ¨å‰ç«¯
cd frontend
npm run dev
```

2. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜**ï¼š
   - æŒ‰ **Ctrl+Shift+Delete**
   - å‹¾é€‰"ç¼“å­˜"å’Œ"Cookie"
   - ç‚¹å‡»"æ¸…é™¤æ•°æ®"

### æµ‹è¯•ä¼šè¯éš”ç¦»

#### æ­¥éª¤ 1ï¼šæ‰“å¼€ç¬¬ä¸€ä¸ªçª—å£

1. è®¿é—® `http://localhost:5173`
2. æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° **Console** æ ‡ç­¾
4. æŸ¥çœ‹è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ†• ç”Ÿæˆæ–°ä¼šè¯ ID: session_1763xxxxxx_xxxx
   ğŸ”„ åˆå§‹åŒ–ä¼šè¯...
   âœ… ä¼šè¯åˆå§‹åŒ–æˆåŠŸ, Conversation ID: 757461xxxxxxx
   ```
5. ç‚¹å‡»å³ä¸‹è§’èŠå¤©æŒ‰é’®
6. å‘é€æ¶ˆæ¯ï¼š"æˆ‘æ˜¯å­è±ª"
7. ç­‰å¾… AI å›å¤

#### æ­¥éª¤ 2ï¼šæ‰“å¼€ç¬¬äºŒä¸ªçª—å£

1. æŒ‰ **Ctrl+Shift+N**ï¼ˆæ— ç—•æ¨¡å¼ï¼‰æˆ– **Ctrl+N**ï¼ˆæ–°çª—å£ï¼‰
2. è®¿é—® `http://localhost:5173`
3. æŒ‰ **F12** â†’ **Console**
4. æŸ¥çœ‹è¾“å‡ºï¼Œåº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ†• ç”Ÿæˆæ–°ä¼šè¯ ID: session_1763yyyyyy_yyyy  â† ä¸çª—å£ 1 ä¸åŒ
   ğŸ”„ åˆå§‹åŒ–ä¼šè¯...
   âœ… ä¼šè¯åˆå§‹åŒ–æˆåŠŸ, Conversation ID: 757462yyyyyyy  â† ä¸çª—å£ 1 ä¸åŒ
   ```
5. æ‰“å¼€èŠå¤©é¢æ¿
6. å‘é€æ¶ˆæ¯ï¼š"æˆ‘æ˜¯è°ï¼Ÿ"

#### æ­¥éª¤ 3ï¼šéªŒè¯ç»“æœ

**é¢„æœŸç»“æœ**ï¼š
- âœ… AI ä¸åº”è¯¥å›ç­”"ä½ æ˜¯å­è±ª"
- âœ… AI åº”è¯¥å›å¤ç±»ä¼¼"æˆ‘ä¸çŸ¥é“æ‚¨çš„åå­—"æˆ–"è¯·é—®æ‚¨æ˜¯è°ï¼Ÿ"

**å¦‚æœéªŒè¯å¤±è´¥**ï¼š
1. æ£€æŸ¥ä¸¤ä¸ªçª—å£çš„ `conversation_id` æ˜¯å¦çœŸçš„ä¸åŒ
2. æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œç¡®è®¤ Coze è¿”å›çš„ `conversation_id` ä¸åŒ
3. ç¡®è®¤ä½¿ç”¨çš„æ˜¯æ–°çª—å£è€Œéæ–°æ ‡ç­¾é¡µ

### æµ‹è¯•æ¸…é™¤å†å²

1. åœ¨ä»»ä¸€çª—å£ä¸­å‘é€å‡ æ¡æ¶ˆæ¯
2. ç‚¹å‡»å³ä¸Šè§’èœå•ï¼ˆä¸‰ä¸ªç‚¹ï¼‰
3. é€‰æ‹©"æ¸…é™¤å†å²"
4. ç¡®è®¤æ¸…é™¤
5. **é¢„æœŸç»“æœ**ï¼šæ¶ˆæ¯åˆ—è¡¨æ¸…ç©ºï¼Œç”Ÿæˆæ–°çš„ `conversation_id`

---

## æ€»ç»“

### é—®é¢˜æœ¬è´¨

**Coze API çš„è¡Œä¸ºç‰¹æ€§**ï¼š
- å½“é¦–æ¬¡å¯¹è¯ä¸ä¼  `conversation_id` æ—¶
- å³ä½¿ä¼ å…¥äº†ä¸åŒçš„ `session_name`
- Coze å¯èƒ½ä»ç„¶è¿”å›ç›¸åŒçš„ `conversation_id`
- å¯¼è‡´ä¸åŒç”¨æˆ·å…±äº«å¯¹è¯ä¸Šä¸‹æ–‡

### è§£å†³æ–¹æ¡ˆæ ¸å¿ƒ

**ä¸»åŠ¨åˆ›å»º conversation**ï¼š
- åœ¨ç”¨æˆ·æ‰“å¼€é¡µé¢æ—¶ç«‹å³è°ƒç”¨ `conversations.create()` API
- ä½¿ç”¨å¸¦æ­£ç¡® `session_name` çš„ token
- Coze ä¼šä¸ºæ¯ä¸ª session åˆ›å»ºç‹¬ç«‹çš„ conversation èµ„æº
- è¿”å›å®Œå…¨ä¸åŒçš„ `conversation_id`
- åç»­å¯¹è¯ä½¿ç”¨è¿™ä¸ªé¢„å…ˆåˆ›å»ºçš„ IDï¼Œç¡®ä¿éš”ç¦»

### å…³é”®è¦ç‚¹

1. âœ… **ä¸èƒ½ä¾èµ–é¦–æ¬¡å¯¹è¯æ—¶ Coze è‡ªåŠ¨ç”Ÿæˆ** - å¯èƒ½è¿”å›ç›¸åŒ ID
2. âœ… **å¿…é¡»ä½¿ç”¨ SDK çš„ create() æ¥å£æ˜¾å¼åˆ›å»º** - ä¿è¯ç‹¬ç«‹èµ„æº
3. âœ… **é¡µé¢åŠ è½½æ—¶ç«‹å³åˆå§‹åŒ–** - è€Œéé¦–æ¬¡å‘æ¶ˆæ¯æ—¶æ‰åˆ›å»º
4. âœ… **å‰ç«¯ä¿å­˜å¹¶ä¼ é€’ conversation_id** - åç»­å¯¹è¯ä½¿ç”¨é¢„åˆ›å»ºçš„ ID

### é€‚ç”¨åœºæ™¯

è¿™ä¸ªè§£å†³æ–¹æ¡ˆé€‚ç”¨äºæ‰€æœ‰åŸºäº Coze çš„å¤šç”¨æˆ·ç³»ç»Ÿï¼š
- âœ… å®¢æœç³»ç»Ÿï¼ˆæ¯ä¸ªå®¢æˆ·ç‹¬ç«‹ä¼šè¯ï¼‰
- âœ… æ•™è‚²å¹³å°ï¼ˆæ¯ä¸ªå­¦ç”Ÿç‹¬ç«‹å­¦ä¹ è®°å½•ï¼‰
- âœ… SaaS åº”ç”¨ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ï¼‰
- âœ… å…¬å¼€ç½‘ç«™åµŒå…¥çš„æ™ºèƒ½ä½“

### é‡è¦æé†’

**è¿™æ˜¯ Coze å¼€å‘çš„æ­£ç¡®å®è·µ**ï¼š
- åœ¨ä»»ä½•å¤šç”¨æˆ·åœºæ™¯ä¸‹
- éƒ½åº”è¯¥åœ¨ç”¨æˆ·è¿›å…¥æ—¶é¢„å…ˆè°ƒç”¨ `conversations.create()`
- è€Œä¸æ˜¯ä¾èµ–é¦–æ¬¡å¯¹è¯æ—¶çš„è‡ªåŠ¨ç”Ÿæˆ
- è¿™æ ·æ‰èƒ½ä¿è¯ä¼šè¯çš„å®Œå…¨éš”ç¦»

---

## é™„å½•

### ç›¸å…³æ–‡ä»¶

- `frontend/src/components/ChatPanel.vue` - å‰ç«¯ä¼šè¯åˆå§‹åŒ–é€»è¾‘
- `frontend/src/stores/chatStore.ts` - å‰ç«¯çŠ¶æ€ç®¡ç†ï¼ˆsession_id ç”Ÿæˆï¼‰
- `backend.py:304-357` - åç«¯åˆ›å»ºä¼šè¯æ¥å£
- `backend.py:657-820` - åç«¯æµå¼èŠå¤©æ¥å£

### å‚è€ƒæ–‡æ¡£

- `docs/å®˜æ–¹ä¼šè¯éš”ç¦»å®ç°æŒ‡å—.md` - Coze å®˜æ–¹ä¼šè¯éš”ç¦»æ–‡æ¡£
- `prd/coze.md` - é¡¹ç›®éœ€æ±‚æ–‡æ¡£

### ç‰ˆæœ¬ä¿¡æ¯

- **å‰ç«¯ç‰ˆæœ¬**: Vue 3 + TypeScript + Pinia
- **åç«¯ç‰ˆæœ¬**: Python 3 + FastAPI + Coze SDK
- **Coze API**: v1 (å›½é™…ç‰ˆ api.coze.com)
- **è§£å†³æ–¹æ¡ˆç‰ˆæœ¬**: v2.3.0ï¼ˆ2025-11-20ï¼‰

---

**æ–‡æ¡£ä½œè€…**: Claude Code
**æœ€åæ›´æ–°**: 2025-11-20
**éªŒè¯çŠ¶æ€**: âœ… å·²é€šè¿‡å®é™…æµ‹è¯•éªŒè¯
