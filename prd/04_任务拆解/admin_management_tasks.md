# ç®¡ç†å‘˜åŠŸèƒ½éœ€æ±‚æ–‡æ¡£ä¸ä»»åŠ¡æ‹†è§£

> æ–‡æ¡£ç‰ˆæœ¬: v1.4
> åˆ›å»ºæ—¶é—´: 2025-11-24
> çŠ¶æ€: âœ… P0 å·²å®Œæˆï¼Œâœ… P1 å·²å®Œæˆ (åŒ…å« ADMIN-09 UIç•Œé¢)
> æ›´æ–°æ—¶é—´: 2025-11-25
> ä¾èµ–: åå¸­è®¤è¯ç³»ç»Ÿ (v2.3.7+)

---

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†åå¸­ç®¡ç†ç³»ç»Ÿçš„ç®¡ç†å‘˜åŠŸèƒ½éœ€æ±‚ï¼ŒåŒ…æ‹¬åå¸­è´¦å· CRUD æ“ä½œã€æƒé™æ§åˆ¶ã€å®¡è®¡æ—¥å¿—ç­‰åŠŸèƒ½ã€‚æ­¤åŠŸèƒ½æ˜¯åå¸­è®¤è¯ç³»ç»Ÿçš„æ‰©å±•ï¼Œæ—¨åœ¨ä¸ºç®¡ç†å‘˜æä¾›å®Œæ•´çš„åå¸­ç®¡ç†èƒ½åŠ›ã€‚

**å…³è”æ–‡æ¡£**ï¼š
- `prd/01_å…¨å±€æŒ‡å¯¼/PRD_COMPLETE_v3.0.md` - ä¸» PRD æ–‡æ¡£
- `prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md` - API æ¥å£å¥‘çº¦
- `prd/02_çº¦æŸä¸åŸåˆ™/CONSTRAINTS_AND_PRINCIPLES.md` - çº¦æŸ17ï¼ˆåå¸­è®¤è¯ï¼‰

---

## 1. éœ€æ±‚èƒŒæ™¯

### 1.1 å½“å‰çŠ¶æ€

åå¸­è®¤è¯ç³»ç»Ÿ v2.3.7 å·²å®ç°åŸºç¡€åŠŸèƒ½ï¼š
- âœ… åå¸­ç™»å½•/ç™»å‡º
- âœ… JWT Token è®¤è¯
- âœ… å¯†ç åŠ å¯†å­˜å‚¨
- âœ… Token åˆ·æ–°æœºåˆ¶
- âœ… 3ä¸ªé»˜è®¤è´¦å·

### 1.2 ç¼ºå¤±åŠŸèƒ½

- âŒ ç®¡ç†å‘˜åˆ›å»ºæ–°åå¸­è´¦å·
- âŒ ç®¡ç†å‘˜ä¿®æ”¹åå¸­ä¿¡æ¯
- âŒ ç®¡ç†å‘˜åˆ é™¤åå¸­è´¦å·
- âŒ åå¸­è‡ªå·±ä¿®æ”¹å¯†ç 
- âŒ åå¸­åˆ—è¡¨æŸ¥è¯¢
- âŒ JWT æƒé™ä¸­é—´ä»¶
- âŒ è§’è‰²æƒé™æ§åˆ¶
- âŒ å®¡è®¡æ—¥å¿—

### 1.3 ä¸šåŠ¡ä»·å€¼

- å‡å°‘è¿ç»´å·¥ä½œé‡ï¼šç®¡ç†å‘˜å¯è‡ªåŠ©ç®¡ç†åå¸­
- æé«˜å®‰å…¨æ€§ï¼šæƒé™æ§åˆ¶å’Œå®¡è®¡æ—¥å¿—
- æå‡ç”¨æˆ·ä½“éªŒï¼šåå¸­å¯è‡ªå·±ä¿®æ”¹å¯†ç 

---

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 ä¼˜å…ˆçº§å®šä¹‰

| ä¼˜å…ˆçº§ | å«ä¹‰ | äº¤ä»˜æ—¶é—´ |
|-------|------|---------|
| P0 | å¿…é¡»å®ç° | æœ¬è¿­ä»£å®Œæˆ |
| P1 | åº”è¯¥å®ç° | ä¸‹è¿­ä»£å®Œæˆ |
| P2 | å¯ä»¥å®ç° | å¾…å®š |

### 2.2 åŠŸèƒ½åˆ—è¡¨

#### P0 - æ ¸å¿ƒç®¡ç†åŠŸèƒ½ âœ… å·²å®Œæˆ (2025-11-25)

| åŠŸèƒ½ID | åŠŸèƒ½åç§° | æè¿° | è§’è‰² | çŠ¶æ€ |
|--------|---------|------|------|------|
| ADMIN-01 | JWT æƒé™ä¸­é—´ä»¶ | ä¿æŠ¤éœ€è¦è®¤è¯çš„ API | ç³»ç»Ÿ | âœ… å·²å®Œæˆ |
| ADMIN-02 | åå¸­åˆ—è¡¨æŸ¥è¯¢ | ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰åå¸­ | admin | âœ… å·²å®Œæˆ |
| ADMIN-03 | åˆ›å»ºåå¸­è´¦å· | ç®¡ç†å‘˜åˆ›å»ºæ–°åå¸­ | admin | âœ… å·²å®Œæˆ |
| ADMIN-04 | ä¿®æ”¹åå¸­ä¿¡æ¯ | ç®¡ç†å‘˜ä¿®æ”¹åå¸­èµ„æ–™ | admin | âœ… å·²å®Œæˆ |
| ADMIN-05 | åˆ é™¤åå¸­è´¦å· | ç®¡ç†å‘˜åˆ é™¤åå¸­ | admin | âœ… å·²å®Œæˆ |
| ADMIN-06 | é‡ç½®åå¸­å¯†ç  | ç®¡ç†å‘˜é‡ç½®å¯†ç  | admin | âœ… å·²å®Œæˆ |

**å®ç°æ€»ç»“**ï¼š
- **æ–‡ä»¶ä¿®æ”¹**: `backend.py` (æ·»åŠ JWTæƒé™ä¸­é—´ä»¶), `src/agent_auth.py` (ä¿®å¤æ—¶åŒºbug)
- **æµ‹è¯•**: 7/7 æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œ12/12 å›å½’æµ‹è¯•é€šè¿‡
- **Bugä¿®å¤**: ä¿®å¤JWT Tokenæ—¶åŒºé—®é¢˜ï¼ˆUTC+8æ—¶åŒºå¯¼è‡´Tokenç«‹å³è¿‡æœŸï¼‰

#### P1 - è‡ªåŠ©åŠŸèƒ½ä¸ç®¡ç†ç•Œé¢ âœ… å·²å®Œæˆ (2025-11-25)

| åŠŸèƒ½ID | åŠŸèƒ½åç§° | æè¿° | è§’è‰² | çŠ¶æ€ |
|--------|---------|------|------|------|
| ADMIN-07 | ä¿®æ”¹è‡ªå·±å¯†ç  | åå¸­ä¿®æ”¹è‡ªå·±çš„å¯†ç  | agent/admin | âœ… å·²å®Œæˆ |
| ADMIN-08 | ä¿®æ”¹ä¸ªäººèµ„æ–™ | åå¸­ä¿®æ”¹è‡ªå·±çš„ä¿¡æ¯ | agent/admin | âœ… å·²å®Œæˆ |
| ADMIN-09 | ç®¡ç†å‘˜UIç•Œé¢ | åå¸­ç®¡ç†å‰ç«¯ç•Œé¢ | admin | âœ… å·²å®Œæˆ |

**ADMIN-07 å®æ–½æ€»ç»“** (2025-11-25):
- **APIæ¥å£**: POST /api/agent/change-password
- **æƒé™éªŒè¯**: require_agent()ï¼ˆä»»ä½•ç™»å½•ç”¨æˆ·å¯ä¿®æ”¹è‡ªå·±å¯†ç ï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**:
  - éªŒè¯æ—§å¯†ç æ­£ç¡®æ€§
  - æ–°å¯†ç å¼ºåº¦éªŒè¯ï¼ˆè‡³å°‘8å­—ç¬¦ï¼Œå«å­—æ¯å’Œæ•°å­—ï¼‰
  - æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ
- **æµ‹è¯•ç»“æœ**: 6/7 é€šè¿‡ï¼ˆPydanticå­—æ®µéªŒè¯è¿”å›422ç¬¦åˆé¢„æœŸï¼‰
- **å›å½’æµ‹è¯•**: 12/12 é€šè¿‡
- **æ–‡ä»¶ä¿®æ”¹**: `backend.py` (æ–°å¢æ¥å£), `src/agent_auth.py` (æ–°å¢ChangePasswordRequestæ¨¡å‹)

**ADMIN-08 å®æ–½æ€»ç»“** (2025-11-25):
- **APIæ¥å£**: PUT /api/agent/profile
- **æƒé™éªŒè¯**: require_agent()ï¼ˆä»»ä½•ç™»å½•ç”¨æˆ·å¯ä¿®æ”¹è‡ªå·±èµ„æ–™ï¼‰
- **æ ¸å¿ƒåŠŸèƒ½**:
  - åªå…è®¸ä¿®æ”¹ name å’Œ avatar_url
  - ç¦æ­¢ä¿®æ”¹ roleã€usernameã€max_sessions ç­‰æ•æ„Ÿå­—æ®µ
  - è‡³å°‘éœ€è¦æä¾›ä¸€ä¸ªå­—æ®µ
- **æµ‹è¯•ç»“æœ**: 8/8 å…¨éƒ¨é€šè¿‡
- **å›å½’æµ‹è¯•**: 12/12 é€šè¿‡
- **æ–‡ä»¶ä¿®æ”¹**: `backend.py` (æ–°å¢æ¥å£), `src/agent_auth.py` (æ–°å¢UpdateProfileRequestæ¨¡å‹)

**ADMIN-09 å®æ–½æ€»ç»“** (2025-11-25):
- **å‰ç«¯é¡µé¢**: `/admin/agents` - åå¸­ç®¡ç†é¡µé¢
- **æ ¸å¿ƒç»„ä»¶**:
  1. `views/AdminManagement.vue` - ä¸»é¡µé¢ï¼ˆåå¸­åˆ—è¡¨ã€æœç´¢ã€ç­›é€‰ã€åˆ†é¡µï¼‰
  2. `components/admin/CreateAgentDialog.vue` - åˆ›å»ºåå¸­å¯¹è¯æ¡†
  3. `components/admin/EditAgentDialog.vue` - ç¼–è¾‘åå¸­å¯¹è¯æ¡†
  4. `components/admin/ResetPasswordDialog.vue` - é‡ç½®å¯†ç å¯¹è¯æ¡†
  5. `components/admin/ChangePasswordDialog.vue` - ä¿®æ”¹è‡ªå·±å¯†ç å¯¹è¯æ¡†
  6. `components/admin/ProfileDialog.vue` - ä¿®æ”¹ä¸ªäººèµ„æ–™å¯¹è¯æ¡†
- **æƒé™æ§åˆ¶**:
  - è·¯ç”±å®ˆå«ï¼šrequiresAdmin metaæ ‡å¿—
  - Dashboardèœå•ï¼šä»…ç®¡ç†å‘˜å¯è§ï¼ˆv-if="agentStore.agentRole === 'admin'"ï¼‰
  - åç«¯APIï¼šrequire_admin() ä¸­é—´ä»¶
- **åŠŸèƒ½ç‰¹æ€§**:
  - å®æ—¶æœç´¢ï¼ˆç”¨æˆ·åã€å§“åã€IDï¼‰
  - è§’è‰²/çŠ¶æ€ç­›é€‰
  - è¡¨å•éªŒè¯ï¼ˆå¯†ç å¼ºåº¦ã€ç”¨æˆ·åæ ¼å¼ï¼‰
  - åˆ†é¡µæ”¯æŒ
  - æ“ä½œæŒ‰é’®ï¼šç¼–è¾‘ã€é‡ç½®å¯†ç ã€åˆ é™¤
- **æµ‹è¯•ç»“æœ**:
  - TypeScript ç¼–è¯‘é€šè¿‡ï¼ˆæ— é”™è¯¯ï¼‰
  - å›å½’æµ‹è¯•: 12/12 é€šè¿‡
- **æ–‡ä»¶ä¿®æ”¹**:
  - `agent-workbench/src/types/index.ts` (æ·»åŠ ç±»å‹å®šä¹‰)
  - `agent-workbench/src/stores/adminStore.ts` (æ–°å¢)
  - `agent-workbench/src/stores/agentStore.ts` (æ·»åŠ roleæ”¯æŒ)
  - `agent-workbench/src/router/index.ts` (æ·»åŠ è·¯ç”±å’Œå®ˆå«)
  - `agent-workbench/src/views/AdminManagement.vue` (æ–°å¢)
  - `agent-workbench/src/views/Dashboard.vue` (æ·»åŠ ç®¡ç†å‘˜èœå•)
  - `agent-workbench/src/components/admin/` (5ä¸ªå¯¹è¯æ¡†ç»„ä»¶)


#### P2 - é«˜çº§åŠŸèƒ½

| åŠŸèƒ½ID | åŠŸèƒ½åç§° | æè¿° | è§’è‰² |
|--------|---------|------|------|
| ADMIN-09 | å®¡è®¡æ—¥å¿—æŸ¥è¯¢ | æŸ¥çœ‹æ“ä½œå†å² | admin |
| ADMIN-10 | æ‰¹é‡å¯¼å…¥åå¸­ | CSV æ‰¹é‡åˆ›å»º | admin |
| ADMIN-11 | åå¸­çŠ¶æ€ç›‘æ§ | å®æ—¶åœ¨çº¿çŠ¶æ€ | admin |

---

## 3. è¯¦ç»†éœ€æ±‚

### 3.1 ADMIN-01: JWT æƒé™ä¸­é—´ä»¶

**ä¼˜å…ˆçº§**: P0

**åŠŸèƒ½æè¿°**ï¼š
åˆ›å»º FastAPI ä¾èµ–é¡¹ï¼ŒéªŒè¯è¯·æ±‚ä¸­çš„ JWT Tokenï¼Œä¿æŠ¤éœ€è¦è®¤è¯çš„ APIã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š

```python
from fastapi import Depends, HTTPException
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

async def verify_agent_token(
    credentials: HTTPAuthorizationCredentials = Depends(security)
) -> Dict[str, Any]:
    """éªŒè¯ JWT Token ä¸­é—´ä»¶"""
    token = credentials.credentials

    payload = agent_token_manager.verify_token(token)
    if not payload:
        raise HTTPException(401, detail="Token æ— æ•ˆæˆ–å·²è¿‡æœŸ")

    return payload

async def require_admin(
    agent = Depends(verify_agent_token)
) -> Dict[str, Any]:
    """è¦æ±‚ç®¡ç†å‘˜æƒé™"""
    if agent.get("role") != "admin":
        raise HTTPException(403, detail="éœ€è¦ç®¡ç†å‘˜æƒé™")
    return agent
```

**éœ€è¦ä¿æŠ¤çš„ API**ï¼š
- `GET /api/agents` - åå¸­åˆ—è¡¨
- `POST /api/agents` - åˆ›å»ºåå¸­
- `PUT /api/agents/{username}` - ä¿®æ”¹åå¸­
- `DELETE /api/agents/{username}` - åˆ é™¤åå¸­
- `POST /api/agents/{username}/reset-password` - é‡ç½®å¯†ç 
- `GET /api/sessions` - ä¼šè¯åˆ—è¡¨
- `POST /api/sessions/{session_name}/takeover` - æ¥å…¥ä¼šè¯
- `POST /api/manual/messages` - å‘é€æ¶ˆæ¯

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ—  Token è¯·æ±‚è¿”å› 401
- [ ] è¿‡æœŸ Token è¯·æ±‚è¿”å› 401
- [ ] æ— æ•ˆ Token è¯·æ±‚è¿”å› 401
- [ ] æœ‰æ•ˆ Token è¯·æ±‚æ­£å¸¸å¤„ç†
- [ ] æ™®é€šåå¸­è®¿é—®ç®¡ç†æ¥å£è¿”å› 403

---

### 3.2 ADMIN-02: åå¸­åˆ—è¡¨æŸ¥è¯¢

**ä¼˜å…ˆçº§**: P0

**API æ¥å£**ï¼š

```
GET /api/agents
Authorization: Bearer <admin_token>
```

**Query å‚æ•°**ï¼š

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| status | string | å¦ | è¿‡æ»¤çŠ¶æ€ (online/offline/busy) |
| role | string | å¦ | è¿‡æ»¤è§’è‰² (admin/agent) |
| page | int | å¦ | é¡µç ï¼Œé»˜è®¤1 |
| page_size | int | å¦ | æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20 |

**å“åº”æ ¼å¼**ï¼š

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": "agent_123",
        "username": "admin",
        "name": "ç³»ç»Ÿç®¡ç†å‘˜",
        "role": "admin",
        "status": "online",
        "max_sessions": 10,
        "created_at": 1763973603.8,
        "last_login": 1763974123.4
      }
    ],
    "total": 3,
    "page": 1,
    "page_size": 20
  }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] è¿”å›æ‰€æœ‰åå¸­åˆ—è¡¨
- [ ] ä¸åŒ…å« password_hash
- [ ] æ”¯æŒçŠ¶æ€è¿‡æ»¤
- [ ] æ”¯æŒè§’è‰²è¿‡æ»¤
- [ ] æ”¯æŒåˆ†é¡µ
- [ ] ä»…ç®¡ç†å‘˜å¯è®¿é—®

---

### 3.3 ADMIN-03: åˆ›å»ºåå¸­è´¦å·

**ä¼˜å…ˆçº§**: P0

**API æ¥å£**ï¼š

```
POST /api/agents
Authorization: Bearer <admin_token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "username": "agent003",
  "password": "secure_password_123",
  "name": "å®¢æœå°å¼ ",
  "role": "agent",
  "max_sessions": 5,
  "avatar_url": null
}
```

**å“åº”æ ¼å¼**ï¼š

```json
{
  "success": true,
  "agent": {
    "id": "agent_1763980000000",
    "username": "agent003",
    "name": "å®¢æœå°å¼ ",
    "role": "agent",
    "status": "offline",
    "max_sessions": 5,
    "created_at": 1763980000.0
  }
}
```

**é”™è¯¯å“åº”**ï¼š

| çŠ¶æ€ç  | é”™è¯¯ç  | è¯´æ˜ |
|-------|-------|------|
| 400 | USERNAME_EXISTS | ç”¨æˆ·åå·²å­˜åœ¨ |
| 400 | INVALID_PASSWORD | å¯†ç ä¸ç¬¦åˆè¦æ±‚ |
| 403 | FORBIDDEN | éç®¡ç†å‘˜ |

**å¯†ç è¦æ±‚**ï¼š
- æœ€å°‘ 8 ä¸ªå­—ç¬¦
- åŒ…å«å­—æ¯å’Œæ•°å­—

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æˆåŠŸåˆ›å»ºåå¸­è´¦å·
- [ ] å¯†ç æ­£ç¡®åŠ å¯†å­˜å‚¨
- [ ] ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
- [ ] å¯†ç å¼ºåº¦éªŒè¯
- [ ] ä»…ç®¡ç†å‘˜å¯åˆ›å»º

---

### 3.4 ADMIN-04: ä¿®æ”¹åå¸­ä¿¡æ¯

**ä¼˜å…ˆçº§**: P0

**API æ¥å£**ï¼š

```
PUT /api/agents/{username}
Authorization: Bearer <admin_token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "name": "å®¢æœå¼ ä¸‰",
  "role": "agent",
  "max_sessions": 8,
  "status": "online",
  "avatar_url": "/avatars/zhang.png"
}
```

**å“åº”æ ¼å¼**ï¼š

```json
{
  "success": true,
  "agent": {
    "id": "agent_123",
    "username": "agent003",
    "name": "å®¢æœå¼ ä¸‰",
    "role": "agent",
    "status": "online",
    "max_sessions": 8
  }
}
```

**é™åˆ¶**ï¼š
- ä¸èƒ½é€šè¿‡æ­¤æ¥å£ä¿®æ”¹å¯†ç 
- ä¸èƒ½ä¿®æ”¹ username
- ä¸èƒ½é™çº§æœ€åä¸€ä¸ª admin

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æˆåŠŸä¿®æ”¹åå¸­ä¿¡æ¯
- [ ] ä¸èƒ½ä¿®æ”¹å¯†ç 
- [ ] ä¸èƒ½ä¿®æ”¹ç”¨æˆ·å
- [ ] ä¿æŠ¤æœ€åä¸€ä¸ªç®¡ç†å‘˜
- [ ] ä»…ç®¡ç†å‘˜å¯ä¿®æ”¹

---

### 3.5 ADMIN-05: åˆ é™¤åå¸­è´¦å·

**ä¼˜å…ˆçº§**: P0

**API æ¥å£**ï¼š

```
DELETE /api/agents/{username}
Authorization: Bearer <admin_token>
```

**å“åº”æ ¼å¼**ï¼š

```json
{
  "success": true,
  "message": "åå¸­ agent003 å·²åˆ é™¤"
}
```

**é™åˆ¶**ï¼š
- ä¸èƒ½åˆ é™¤è‡ªå·±
- ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ª admin
- ä¸èƒ½åˆ é™¤æœ‰æ´»è·ƒä¼šè¯çš„åå¸­

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æˆåŠŸåˆ é™¤åå¸­
- [ ] ä» Redis ä¸­åˆ é™¤æ•°æ®
- [ ] ä¸èƒ½åˆ é™¤è‡ªå·±
- [ ] ä¿æŠ¤æœ€åä¸€ä¸ªç®¡ç†å‘˜
- [ ] æ£€æŸ¥æ´»è·ƒä¼šè¯

---

### 3.6 ADMIN-06: é‡ç½®åå¸­å¯†ç 

**ä¼˜å…ˆçº§**: P0

**API æ¥å£**ï¼š

```
POST /api/agents/{username}/reset-password
Authorization: Bearer <admin_token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "new_password": "new_secure_password_456"
}
```

**å“åº”æ ¼å¼**ï¼š

```json
{
  "success": true,
  "message": "å¯†ç å·²é‡ç½®"
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æˆåŠŸé‡ç½®å¯†ç 
- [ ] æ–°å¯†ç æ­£ç¡®åŠ å¯†
- [ ] å¯†ç å¼ºåº¦éªŒè¯
- [ ] ä»…ç®¡ç†å‘˜å¯é‡ç½®

---

### 3.7 ADMIN-07: ä¿®æ”¹è‡ªå·±å¯†ç 

**ä¼˜å…ˆçº§**: P1

**API æ¥å£**ï¼š

```
POST /api/agent/change-password
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "old_password": "current_password",
  "new_password": "new_secure_password"
}
```

**å“åº”æ ¼å¼**ï¼š

```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] éªŒè¯æ—§å¯†ç æ­£ç¡®
- [ ] æ–°å¯†ç å¼ºåº¦éªŒè¯
- [ ] æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
- [ ] ä»»ä½•ç™»å½•ç”¨æˆ·å¯ä¿®æ”¹è‡ªå·±å¯†ç 

---

### 3.8 ADMIN-08: ä¿®æ”¹ä¸ªäººèµ„æ–™

**ä¼˜å…ˆçº§**: P1

**API æ¥å£**ï¼š

```
PUT /api/agent/profile
Authorization: Bearer <token>
Content-Type: application/json
```

**è¯·æ±‚ä½“**ï¼š

```json
{
  "name": "æˆ‘çš„æ–°åå­—",
  "avatar_url": "/avatars/my.png"
}
```

**é™åˆ¶**ï¼š
- åªèƒ½ä¿®æ”¹ name å’Œ avatar_url
- ä¸èƒ½ä¿®æ”¹ roleã€usernameã€max_sessions

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æˆåŠŸä¿®æ”¹ä¸ªäººèµ„æ–™
- [ ] åªèƒ½ä¿®æ”¹å…è®¸çš„å­—æ®µ
- [ ] ä»»ä½•ç™»å½•ç”¨æˆ·å¯ä¿®æ”¹è‡ªå·±

---

### 3.9 ADMIN-09: å®¡è®¡æ—¥å¿—

**ä¼˜å…ˆçº§**: P2

**åŠŸèƒ½æè¿°**ï¼š
è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œçš„å®¡è®¡æ—¥å¿—ã€‚

**è®°å½•å†…å®¹**ï¼š
- ç™»å½•/ç™»å‡º
- åˆ›å»º/åˆ é™¤åå¸­
- ä¿®æ”¹å¯†ç 
- æƒé™å˜æ›´

**å­˜å‚¨æ ¼å¼**ï¼š

```json
{
  "id": "log_123",
  "action": "agent_created",
  "operator": "admin",
  "target": "agent003",
  "details": {"role": "agent"},
  "timestamp": 1763980000.0,
  "ip_address": "192.168.1.100"
}
```

---

## 4. ä»»åŠ¡æ‹†è§£

### 4.1 P0 ä»»åŠ¡åˆ—è¡¨

| ä»»åŠ¡ID | ä»»åŠ¡åç§° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|--------|---------|---------|------|
| ADMIN-T01 | å®ç° JWT æƒé™ä¸­é—´ä»¶ | 2h | æ—  |
| ADMIN-T02 | å®ç°åå¸­åˆ—è¡¨ API | 2h | T01 |
| ADMIN-T03 | å®ç°åˆ›å»ºåå¸­ API | 2h | T01 |
| ADMIN-T04 | å®ç°ä¿®æ”¹åå¸­ API | 2h | T01 |
| ADMIN-T05 | å®ç°åˆ é™¤åå¸­ API | 2h | T01 |
| ADMIN-T06 | å®ç°é‡ç½®å¯†ç  API | 1h | T01 |
| ADMIN-T07 | ç¼–å†™å•å…ƒæµ‹è¯• | 3h | T01-T06 |
| ADMIN-T08 | æ›´æ–° API æ–‡æ¡£ | 1h | T01-T06 |
| ADMIN-T09 | å›å½’æµ‹è¯• | 1h | T07 |

**P0 æ€»è®¡**: çº¦ 16 å°æ—¶

### 4.2 P1 ä»»åŠ¡åˆ—è¡¨

| ä»»åŠ¡ID | ä»»åŠ¡åç§° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|--------|---------|---------|------|
| ADMIN-T10 | å®ç°ä¿®æ”¹å¯†ç  API | 2h | P0 |
| ADMIN-T11 | å®ç°ä¿®æ”¹èµ„æ–™ API | 1h | P0 |
| ADMIN-T12 | å‰ç«¯ç™»å½•é¡µé¢ | 4h | P0 |
| ADMIN-T13 | å‰ç«¯åå¸­ç®¡ç†é¡µé¢ | 6h | P0 |
| ADMIN-T14 | å‰ç«¯æƒé™æ§åˆ¶ | 2h | T12 |

**P1 æ€»è®¡**: çº¦ 15 å°æ—¶

### 4.3 P2 ä»»åŠ¡åˆ—è¡¨

| ä»»åŠ¡ID | ä»»åŠ¡åç§° | é¢„ä¼°å·¥æ—¶ | ä¾èµ– |
|--------|---------|---------|------|
| ADMIN-T15 | å®¡è®¡æ—¥å¿—æ¨¡å— | 4h | P1 |
| ADMIN-T16 | æ‰¹é‡å¯¼å…¥åŠŸèƒ½ | 3h | P1 |
| ADMIN-T17 | çŠ¶æ€ç›‘æ§é¢æ¿ | 4h | P1 |

**P2 æ€»è®¡**: çº¦ 11 å°æ—¶

---

## 5. API æ¥å£æ±‡æ€»

### 5.1 æ–°å¢æ¥å£

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½ | æƒé™ |
|------|------|------|------|
| GET | /api/agents | åå¸­åˆ—è¡¨ | admin |
| POST | /api/agents | åˆ›å»ºåå¸­ | admin |
| PUT | /api/agents/{username} | ä¿®æ”¹åå¸­ | admin |
| DELETE | /api/agents/{username} | åˆ é™¤åå¸­ | admin |
| POST | /api/agents/{username}/reset-password | é‡ç½®å¯†ç  | admin |
| POST | /api/agent/change-password | ä¿®æ”¹è‡ªå·±å¯†ç  | any |
| PUT | /api/agent/profile | ä¿®æ”¹ä¸ªäººèµ„æ–™ | any |

### 5.2 éœ€è¦æ·»åŠ é‰´æƒçš„ç°æœ‰æ¥å£

| æ–¹æ³• | è·¯å¾„ | æƒé™ |
|------|------|------|
| GET | /api/sessions | any |
| POST | /api/sessions/{session_name}/takeover | any |
| POST | /api/manual/messages | any |
| POST | /api/sessions/{session_name}/release | any |

---

## 6. çº¦æŸä¸é™åˆ¶

### 6.1 å®‰å…¨çº¦æŸ

- æ‰€æœ‰ç®¡ç†æ¥å£å¿…é¡»éªŒè¯ JWT Token
- ç®¡ç†å‘˜æ“ä½œå¿…é¡»éªŒè¯ role=admin
- å¯†ç å¿…é¡»ä½¿ç”¨ bcrypt åŠ å¯†
- æ•æ„Ÿæ“ä½œå»ºè®®è®°å½•å®¡è®¡æ—¥å¿—

### 6.2 ä¸šåŠ¡çº¦æŸ

- ä¸èƒ½åˆ é™¤æœ€åä¸€ä¸ªç®¡ç†å‘˜
- ä¸èƒ½åˆ é™¤è‡ªå·±
- ä¸èƒ½åˆ é™¤æœ‰æ´»è·ƒä¼šè¯çš„åå¸­
- å¯†ç è‡³å°‘8å­—ç¬¦ï¼ŒåŒ…å«å­—æ¯æ•°å­—

### 6.3 æ€§èƒ½çº¦æŸ

- åå¸­åˆ—è¡¨æŸ¥è¯¢å¿…é¡»æ”¯æŒåˆ†é¡µ
- å•é¡µæœ€å¤šè¿”å› 100 æ¡è®°å½•

---

## 7. æµ‹è¯•è¦æ±‚

### 7.1 å•å…ƒæµ‹è¯•

- JWT ä¸­é—´ä»¶æµ‹è¯•ï¼ˆæœ‰æ•ˆ/æ— æ•ˆ/è¿‡æœŸ Tokenï¼‰
- æƒé™æ§åˆ¶æµ‹è¯•ï¼ˆadmin/agent è§’è‰²ï¼‰
- CRUD æ“ä½œæµ‹è¯•
- è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆæœ€åä¸€ä¸ªç®¡ç†å‘˜ã€æ´»è·ƒä¼šè¯ï¼‰

### 7.2 é›†æˆæµ‹è¯•

- å®Œæ•´çš„ç®¡ç†å‘˜æ“ä½œæµç¨‹
- å‰åç«¯é›†æˆæµ‹è¯•
- æƒé™æ§åˆ¶ç«¯åˆ°ç«¯æµ‹è¯•

### 7.3 å›å½’æµ‹è¯•

- ç¡®ä¿ä¸ç ´åç°æœ‰åŠŸèƒ½
- åå¸­è®¤è¯åŸºç¡€åŠŸèƒ½æ­£å¸¸
- æ ¸å¿ƒ AI å¯¹è¯åŠŸèƒ½æ­£å¸¸

---

## 8. éªŒæ”¶æ ‡å‡†

### 8.1 åŠŸèƒ½éªŒæ”¶

- [ ] JWT æƒé™ä¸­é—´ä»¶æ­£å¸¸å·¥ä½œ
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹åå¸­åˆ—è¡¨
- [ ] ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºæ–°åå¸­
- [ ] ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹åå¸­ä¿¡æ¯
- [ ] ç®¡ç†å‘˜å¯ä»¥åˆ é™¤åå¸­
- [ ] ç®¡ç†å‘˜å¯ä»¥é‡ç½®å¯†ç 
- [ ] æ™®é€šåå¸­æ— æ³•è®¿é—®ç®¡ç†æ¥å£

### 8.2 å®‰å…¨éªŒæ”¶

- [ ] æ—  Token è¯·æ±‚è¢«æ‹’ç»
- [ ] è¿‡æœŸ Token è¯·æ±‚è¢«æ‹’ç»
- [ ] æƒé™ä¸è¶³è¯·æ±‚è¢«æ‹’ç»
- [ ] å¯†ç æ­£ç¡®åŠ å¯†å­˜å‚¨
- [ ] API å“åº”ä¸åŒ…å«å¯†ç 

### 8.3 æ–‡æ¡£éªŒæ”¶

- [ ] API æ–‡æ¡£å·²æ›´æ–°
- [ ] çº¦æŸæ–‡æ¡£å·²æ›´æ–°
- [ ] æµ‹è¯•ç”¨ä¾‹å·²ç¼–å†™
- [ ] å®æ–½æŠ¥å‘Šå·²åˆ›å»º

---

## 9. é£é™©è¯„ä¼°

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| æƒé™æ§åˆ¶æ¼æ´ | é«˜ | ä¸­ | å®Œå–„æµ‹è¯•ç”¨ä¾‹ |
| æ€§èƒ½é—®é¢˜ | ä¸­ | ä½ | åˆ†é¡µå’Œç¼“å­˜ |
| å…¼å®¹æ€§é—®é¢˜ | ä¸­ | ä½ | å›å½’æµ‹è¯• |

---

## 10. é™„å½•

### 10.1 å‚è€ƒæ–‡æ¡£

- `prd/02_çº¦æŸä¸åŸåˆ™/CONSTRAINTS_AND_PRINCIPLES.md` - çº¦æŸ17
- `prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md` - API å¥‘çº¦
- `docs/åå¸­è®¤è¯ç³»ç»Ÿå®æ–½æŠ¥å‘Š.md` - å®æ–½æŠ¥å‘Š
- `docs/åå¸­è®¤è¯ç³»ç»Ÿç­”ç–‘æ–‡æ¡£.md` - ç­”ç–‘æ–‡æ¡£

### 10.2 æ›´æ–°å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| v1.0 | 2025-11-24 | åˆå§‹ç‰ˆæœ¬ | Claude Code |
| v1.1 | 2025-11-25 | P0å®Œæˆï¼šJWTä¸­é—´ä»¶å’Œç®¡ç†å‘˜CRUD API | Claude Code |
| v1.2 | 2025-11-25 | P1å®Œæˆï¼šADMIN-07ä¿®æ”¹å¯†ç  | Claude Code |
| v1.3 | 2025-11-25 | P1å®Œæˆï¼šADMIN-08ä¿®æ”¹èµ„æ–™ | Claude Code |
| v1.4 | 2025-11-25 | P1å®Œæˆï¼šADMIN-09ç®¡ç†å‘˜UIç•Œé¢ï¼ˆå®Œæ•´å‰ç«¯å®ç°ï¼‰ | Claude Code |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.4
**æœ€åæ›´æ–°**: 2025-11-25
**ç»´æŠ¤è€…**: Fiido AI å®¢æœå¼€å‘å›¢é˜Ÿ
