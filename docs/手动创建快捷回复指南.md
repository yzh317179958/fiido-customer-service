# 手动创建快捷回复指南

## 方式1：通过UI界面创建（推荐）

### 步骤1: 访问快捷回复管理页面

1. **登录坐席工作台**
   - 访问：http://localhost:5174
   - 使用账号：`admin` / `admin123`

2. **进入快捷回复管理**
   - 登录后，在页面右上角找到 **"快捷回复"** 按钮（📄 图标）
   - 点击进入快捷回复管理页面

### 步骤2: 创建快捷回复

1. **点击"新建快捷回复"按钮**（右上角，带 ➕ 图标）

2. **填写表单**：

   **基础信息**：
   - **标题**：例如 `欢迎语`（必填，最多50字符）
   - **内容**：例如 `您好，我是Fiido客服，很高兴为您服务！`（必填，最多500字符）
   - **分类**：从下拉框选择（必填）
     - 问候 (greeting)
     - 售前 (pre_sales)
     - 售后 (after_sales)
     - 物流 (logistics)
     - 技术 (technical)
     - 结束 (closing)
     - 自定义 (custom)

   **可选设置**：
   - **快捷键**：输入 1-9 的数字（可选）
     - 设置后可通过 Ctrl+数字 快速使用
   - **团队共享**：勾选此项后，其他坐席也能看到和使用这条快捷回复

3. **使用变量**（可选）

   在内容中可以使用以下变量（会自动检测）：
   ```
   {customer_name}   - 客户姓名
   {agent_name}      - 坐席姓名
   {order_id}        - 订单号
   {product_name}    - 产品名称
   {order_status}    - 订单状态
   {tracking_number} - 物流单号
   {warranty_period} - 保修期限
   {support_email}   - 客服邮箱
   ```

   **示例**：
   ```
   您好{customer_name}，我是{agent_name}，很高兴为您服务！
   ```

   填写后，表单下方会显示：
   ```
   检测到变量: customer_name, agent_name
   ```

4. **点击"创建"按钮**

### 步骤3: 验证创建成功

创建后，应该能在列表中看到新的快捷回复卡片，显示：
- ✅ 分类标签（带颜色）
- ✅ 标题
- ✅ 内容预览
- ✅ 使用次数（初始为 0）
- ✅ 团队共享标识（如果勾选了）
- ✅ 变量提示（如果包含变量）
- ✅ 快捷键提示（如果设置了）

---

## 方式2：通过脚本批量创建

如果需要快速创建多个测试数据，可以运行脚本：

### 步骤1: 运行脚本

```bash
cd /home/yzh/AI客服/鉴权
bash tests/create_quick_reply_test_data.sh
```

### 步骤2: 查看结果

脚本会自动创建 16 条快捷回复：
- 问候: 3条
- 售前: 3条
- 售后: 3条
- 物流: 2条
- 技术: 2条
- 结束: 3条

---

## 方式3：通过API直接创建（开发调试用）

### 步骤1: 获取Token

```bash
# 登录获取 Token
TOKEN=$(curl -s -X POST http://localhost:8000/api/agent/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | python3 -c "import sys, json; print(json.load(sys.stdin).get('token', ''))")

echo "Token: $TOKEN"
```

### 步骤2: 创建快捷回复

```bash
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "欢迎语",
    "content": "您好，我是Fiido客服，很高兴为您服务！",
    "category": "greeting",
    "is_shared": true
  }'
```

**带变量的示例**：
```bash
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "个性化欢迎",
    "content": "您好{customer_name}，我是{agent_name}，很高兴为您服务！",
    "category": "greeting",
    "shortcut_key": "1",
    "is_shared": true
  }'
```

**带订单号的示例**：
```bash
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "物流查询",
    "content": "您的订单{order_id}当前状态：{order_status}，物流单号：{tracking_number}",
    "category": "logistics",
    "shortcut_key": "4",
    "is_shared": true
  }'
```

---

## 常见问题

### Q1: 创建后在工作台看不到快捷回复？

**可能原因**：
1. 浏览器控制台有错误（F12查看）
2. Token 过期（重新登录）
3. 后端服务未启动（检查 8000 端口）

**解决方案**：
```bash
# 1. 检查后端服务
lsof -i :8000

# 2. 检查 Redis
redis-cli KEYS "quick_reply:*"

# 3. 刷新浏览器页面并打开控制台查看错误
```

### Q2: 快捷短语按钮点击没反应？

**调试步骤**：
1. 打开浏览器控制台（F12）
2. 切换到 Console 标签
3. 点击快捷短语按钮（📝）
4. 查看是否有错误信息

**常见错误**：
- `Failed to fetch` - 后端服务未启动
- `401 Unauthorized` - Token 过期，需要重新登录
- `Network error` - 检查 API_BASE 配置

### Q3: 如何查看已创建的快捷回复？

**方式1：UI界面**
- 访问：http://localhost:5174/quick-replies

**方式2：API查询**
```bash
TOKEN="你的token"
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:8000/api/quick-replies?limit=100
```

**方式3：Redis查询**
```bash
redis-cli KEYS "quick_reply:*" | wc -l  # 查看总数
redis-cli GET "quick_reply:快捷回复ID"   # 查看详情
```

---

## 快速测试清单

创建快捷回复后，按以下顺序测试：

- [ ] 在管理界面能看到创建的快捷回复
- [ ] 分类筛选功能正常
- [ ] 搜索功能正常
- [ ] 点击编辑按钮能打开编辑对话框
- [ ] 在工作台点击快捷短语按钮（📝）
- [ ] 快捷短语面板能正常展开
- [ ] 能看到创建的快捷回复
- [ ] 点击快捷回复能填入输入框
- [ ] 变量显示正常
- [ ] 快捷键提示显示正常

---

**更新时间**: 2025-11-27
**相关文档**: `docs/快捷回复功能测试指南.md`
