# Fiido AI 客服系统 - 合规性说明文档

> **版本**: v1.0
> **创建时间**: 2025-11-25
> **适用范围**: Fiido E-bike 欧洲市场客服系统
> **文档状态**: ✅ 已完成

---

## 📋 文档目的

本文档说明 Fiido AI 客服系统如何满足欧洲市场的数据隐私与产品合规要求，确保系统在企业生产环境中合法合规运行。

---

## 🌍 适用法规

### 1. GDPR（通用数据保护条例）

**适用范围**: 所有欧盟用户的个人数据处理

**法规全称**: General Data Protection Regulation (EU) 2016/679

**核心要求**:
- 用户数据处理需获得明确同意
- 用户有权查看、修改、删除其个人数据
- 数据泄露需在 72 小时内通知监管机构
- 敏感数据必须加密存储和传输

### 2. EU Battery Regulation（欧盟电池法规）

**适用范围**: 所有含电池的 E-bike 产品

**法规全称**: Regulation (EU) 2023/1542

**核心要求**:
- 电池标签必须包含容量、制造商、回收标识
- 提供电池回收说明和回收点信息
- 运输限制警告（航空运输限制）

### 3. CE 认证（欧洲合格认证）

**适用范围**: 所有在欧洲销售的 E-bike 产品

**核心要求**:
- 产品必须通过 CE 认证测试
- 提供符合性声明（Declaration of Conformity）
- 产品手册必须包含 CE 标识和认证号

---

## 🔒 GDPR 合规实施

### 1. 用户同意与透明性

#### 1.1 数据收集同意

**实施方式**:
```python
# SessionState 用户画像字段
class UserProfile:
    gdpr_consent: bool = False          # GDPR 同意状态
    marketing_subscribed: bool = False  # 营销通讯订阅
```

**用户端展示**:
- 首次对话前展示隐私政策链接
- 明确告知收集的数据类型（昵称、邮箱、对话历史）
- 提供同意/拒绝选项
- 用户可随时撤销同意

**数据收集范围**:
| 数据类型 | 必需性 | 用途 | 保留期限 |
|---------|--------|------|---------|
| 昵称 | 可选 | 个性化称呼 | 会话结束后 90 天 |
| 邮箱 | 可选 | 非工作时间联系 | 用户撤销后立即删除 |
| 对话历史 | 必需 | 提供客服支持 | 90 天 |
| 国家/城市 | 自动 | 语言/货币适配 | 会话结束后立即删除 |

#### 1.2 数据透明性

**用户可查看的数据**:
- GET /api/user/profile - 查看个人画像
- GET /api/user/conversations - 查看对话历史
- GET /api/user/consent - 查看同意状态

**实施建议**:
```http
GET /api/user/profile
Response:
{
  "nickname": "John",
  "country": "DE",
  "language": "de",
  "gdpr_consent": true,
  "marketing_subscribed": false,
  "data_collected_at": "2025-11-25T10:00:00Z"
}
```

### 2. 用户权利实施

#### 2.1 访问权（Right to Access）

**用户可请求导出所有个人数据**

**实施方式**:
```http
POST /api/user/data-export
Body: { "email": "user@example.com" }

Response:
{
  "success": true,
  "export_url": "https://example.com/exports/user_data.zip",
  "expires_at": "2025-11-26T10:00:00Z"
}
```

**导出内容**:
- 用户画像（JSON）
- 对话历史（JSON）
- 坐席服务记录（JSON）

#### 2.2 删除权（Right to Erasure - "被遗忘权"）

**用户可请求删除所有个人数据**

**实施方式**:
```http
POST /api/user/delete-account
Body: { "email": "user@example.com" }

Response:
{
  "success": true,
  "message": "您的数据将在 7 个工作日内永久删除"
}
```

**删除范围**:
- 用户画像（nickname、email、phone）
- 对话历史（匿名化处理，保留用于AI训练的文本）
- 坐席服务记录（仅删除关联的用户信息）

**例外情况**:
- 法律要求保留的数据（如税务记录）保留 7 年
- 已匿名化的数据用于AI训练不受删除权限制

#### 2.3 更正权（Right to Rectification）

**用户可请求修改个人数据**

**实施方式**:
```http
PUT /api/user/profile
Body: {
  "nickname": "New Name",
  "marketing_subscribed": false
}
```

#### 2.4 限制处理权（Right to Restriction）

**用户可请求暂停数据处理（不删除数据）**

**实施方式**:
- 用户可暂停营销通讯
- 用户可暂停 AI 训练数据使用
- 数据仍保留但不主动处理

### 3. 数据安全措施

#### 3.1 数据加密

**传输加密**:
- ✅ 生产环境强制 HTTPS（TLS 1.3）
- ✅ WebSocket/SSE 连接使用 WSS/HTTPS
- ✅ API 调用强制 HTTPS

**存储加密**:
```python
# 敏感字段加密（示例）
from cryptography.fernet import Fernet

class EncryptedField:
    def encrypt(self, value: str) -> str:
        """加密敏感字段"""
        return fernet.encrypt(value.encode()).decode()

    def decrypt(self, encrypted_value: str) -> str:
        """解密敏感字段"""
        return fernet.decrypt(encrypted_value.encode()).decode()

# 应用于敏感字段
user_profile.email = encrypt(user_email)
user_profile.phone = encrypt(user_phone)
```

**加密字段清单**:
| 字段 | 加密方式 | 说明 |
|------|---------|------|
| 邮箱 | AES-256 | 存储前加密 |
| 电话 | AES-256 | 存储前加密 |
| 地址 | AES-256 | 存储前加密（如收集） |
| 密码 | bcrypt | 坐席账号密码 |

#### 3.2 访问控制

**角色权限**:
| 角色 | 可访问数据 | 权限范围 |
|------|----------|---------|
| 坐席 | 分配给自己的会话 | 只读（昵称、对话历史） |
| 组长 | 本组坐席的会话 | 只读 + 转接 |
| 管理员 | 所有会话 | 只读 + 统计分析 |

**实施方式**:
- JWT Token 包含 role 字段
- API 中间件验证权限
- 数据库查询添加 where 条件过滤

#### 3.3 日志脱敏

**禁止记录的敏感信息**:
- ❌ 用户邮箱完整值
- ❌ 用户电话完整值
- ❌ 支付卡号
- ❌ JWT Token 完整值
- ❌ 坐席密码

**日志示例（正确）**:
```
INFO: User session created - session_name=session_123, user_id=user_***45, country=DE
ERROR: Login failed - agent_id=agent_001, ip=192.168.***.***
```

### 4. 数据泄露应急响应

**72 小时通知流程**:

1. **发现阶段**（0-2小时）:
   - 技术团队发现数据泄露迹象
   - 立即启动应急响应流程
   - 隔离受影响系统

2. **评估阶段**（2-12小时）:
   - 确定泄露范围（影响用户数量）
   - 确定泄露数据类型（敏感程度）
   - 评估潜在影响

3. **通知阶段**（12-72小时）:
   - 通知 GDPR 监管机构（如 German BfDI）
   - 通知受影响用户
   - 公开披露（如影响大量用户）

4. **补救阶段**（72小时后）:
   - 修复安全漏洞
   - 为受影响用户提供补偿措施
   - 更新安全策略

**通知模板**:
```
主题: Fiido AI 客服系统数据安全通知

尊敬的用户：

我们于 {日期} 发现一起数据安全事件，可能影响您的以下信息：
- {数据类型清单}

我们已采取以下措施：
- {补救措施}

您可以采取的措施：
- {用户自保建议}

如有疑问，请联系: privacy@fiido.com
```

---

## 🔋 EU Battery Regulation 合规实施

### 1. 电池标签要求

**系统支持**:
- AI 知识库包含所有 E-bike 车型的电池规格
- 坐席工作台显示电池信息快捷查询

**信息模板**:
```markdown
### C11 Pro 电池信息

**容量**: 48V 14.5Ah (696Wh)
**制造商**: {制造商名称}
**型号**: {电池型号}
**重量**: 3.5 kg
**充电时间**: 6-8 小时

**回收标识**: ♻️ 请勿丢弃至普通垃圾桶

**环保回收说明**:
- 欧盟境内免费回收
- 回收点查询: www.fiido.com/battery-recycling
- 德国回收点: {具体地址}
```

### 2. 运输限制

**航空运输警告**:
```
⚠️ 重要提示：

根据 IATA 规定，锂电池超过 100Wh 不得作为手提行李携带。

C11 Pro 电池容量 696Wh，**禁止**航空运输。

建议运输方式：
- ✅ 陆运（汽车、火车）
- ✅ 海运
- ❌ 航空（禁止）
```

**AI 对话示例**:
```
用户: "我可以带电池上飞机吗？"
AI: "很抱歉，C11 Pro 的电池容量为 696Wh，超过航空运输允许的 100Wh 限制，不能作为手提或托运行李携带。建议您使用陆运或海运方式运输电动自行车。"
```

### 3. 回收点信息

**系统集成**:
- 知识库包含欧洲各国回收点地址
- 坐席可根据用户国家快速查询

**数据结构**:
```json
{
  "country": "DE",
  "city": "Berlin",
  "recycling_points": [
    {
      "name": "BSR Recyclinghof",
      "address": "Straße des 17. Juni, 10623 Berlin",
      "phone": "+49 30 7592 4900",
      "hours": "Mo-Fr 9:00-18:00"
    }
  ]
}
```

---

## ✅ CE 认证合规实施

### 1. 认证信息管理

**车型认证数据库**:
```json
{
  "model": "C11 Pro",
  "ce_certification": {
    "number": "CE-FIIDO-C11P-2024",
    "issue_date": "2024-01-15",
    "expiry_date": "2029-01-14",
    "test_lab": "TÜV Rheinland",
    "certificate_url": "https://fiido.com/certificates/C11-Pro-CE.pdf"
  },
  "standards_compliance": [
    "EN 15194:2017 (EPAC standard)",
    "EN ISO 4210-2:2015 (Safety requirements)"
  ]
}
```

### 2. AI 对话支持

**关键词识别**:
- "合法性"、"CE 认证"、"符合欧洲标准"、"可以上路吗"

**AI 回复模板**:
```
您好！C11 Pro 已通过欧洲 CE 认证，完全符合欧盟 EPAC（电动助力自行车）标准 EN 15194:2017。

认证编号: CE-FIIDO-C11P-2024
认证机构: TÜV Rheinland
有效期至: 2029年1月

这意味着您可以在欧盟所有国家合法上路（需遵守各国的骑行规定，如戴头盔、年龄限制等）。

如需查看完整认证文件，请访问：
https://fiido.com/certificates/C11-Pro-CE.pdf
```

### 3. 符合性声明

**系统功能**:
- 用户可下载 Declaration of Conformity PDF
- AI 自动识别下载请求并提供链接
- 坐席可快速发送符合性声明文件

---

## 📊 合规性检查清单

### GDPR 合规检查

- [ ] 隐私政策已展示给用户
- [ ] 用户同意状态已记录（gdpr_consent 字段）
- [ ] 敏感数据已加密存储（邮箱、电话）
- [ ] 全链路 HTTPS 已启用
- [ ] 用户可查看个人数据
- [ ] 用户可导出个人数据
- [ ] 用户可删除个人数据
- [ ] 日志已脱敏（无敏感信息）
- [ ] 访问控制已实施（坐席只能访问分配会话）
- [ ] 数据泄露应急流程已建立

### EU Battery Regulation 合规检查

- [ ] 知识库包含所有车型电池规格
- [ ] AI 可正确回答电池容量问题
- [ ] 运输限制警告已添加
- [ ] 回收点信息已录入系统
- [ ] 坐席可快速查询回收点

### CE 认证合规检查

- [ ] 所有车型 CE 认证号已录入
- [ ] AI 可正确回答合法性问题
- [ ] 符合性声明文件可下载
- [ ] 认证证书 URL 有效

---

## 🔄 持续合规流程

### 1. 定期审计

**频率**: 每季度一次

**审计内容**:
- 检查新增车型是否已获得 CE 认证
- 检查用户数据处理是否符合 GDPR
- 检查访问日志是否有异常访问
- 检查加密证书是否即将过期

### 2. 法规更新跟踪

**责任人**: 合规官

**流程**:
1. 订阅 GDPR、EU Battery Regulation 更新通知
2. 每月检查法规变更
3. 评估对系统的影响
4. 更新系统实施方案
5. 通知技术团队执行

### 3. 用户投诉处理

**GDPR 投诉流程**:
1. 用户通过 privacy@fiido.com 提交投诉
2. 合规官 24 小时内确认收到
3. 7 个工作日内调查并回复
4. 如确认违规，立即采取补救措施
5. 记录投诉并归档

---

## 📚 相关文档

- `prd/01_全局指导/PRD_COMPLETE_v3.0.md` - 第 11 节（合规性与安全性要求）
- `prd/03_技术方案/api_contract.md` - 用户画像数据模型
- `CLAUDE.md` - 安全性开发规范

---

## 📞 合规性咨询联系方式

**数据保护官（DPO）**: privacy@fiido.com
**GDPR 投诉**: gdpr@fiido.com
**产品合规**: compliance@fiido.com

---

**文档维护者**: Fiido 合规团队
**最后更新**: 2025-11-25
**文档版本**: v1.0
