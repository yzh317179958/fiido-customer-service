# 快捷回复功能测试指南

> 版本: v3.7.0
> 更新时间: 2025-11-27
> 测试人员: 参考本文档进行手动测试

## 功能概述

快捷回复功能允许坐席创建、管理和使用预设的回复模板，提高客服效率。

**核心功能**：

1. ✅ 快捷回复管理（CRUD）
2. ✅ 分类管理（7个预设分类）
3. ✅ 变量替换（8个支持的变量）
4. ✅ 团队共享
5. ✅ 快捷键支持
6. ✅ 搜索和筛选

---

## 测试前准备

### 1. 确认服务运行状态

```bash
# 后端服务（必须）
lsof -i :8000
# 应该看到 python3 backend.py

# 坐席工作台（必须）
lsof -i :5174
# 应该看到 vite 进程
```

### 2. 访问地址


| 页面         | URL                                 | 说明     |
| ------------ | ----------------------------------- | -------- |
| 坐席工作台   | http://localhost:5174               | 登录入口 |
| 快捷回复管理 | http://localhost:5174/quick-replies | 管理界面 |

### 3. 测试账号


| 用户名   | 密码     | 角色   | 说明                 |
| -------- | -------- | ------ | -------------------- |
| admin    | admin123 | 管理员 | 可以管理所有快捷回复 |
| agent001 | agent123 | 坐席   | 只能管理自己创建的   |

---

## 测试步骤

### 📋 阶段1: 快捷回复管理界面测试

#### 1.1 访问管理界面

**操作步骤**：

1. 访问 http://localhost:5174
2. 使用 `admin/admin123` 登录
3. 登录后，在右上角找到"快捷回复"按钮（📄 图标）
4. 点击进入快捷回复管理页面

**预期结果**：
✅ 进入快捷回复管理界面
✅ 看到"新建快捷回复"按钮
✅ 看到筛选栏（分类、搜索、只看我的）

#### 1.2 创建快捷回复

**测试用例1: 创建简单快捷回复**

**操作步骤**：

1. 点击"➕ 新建快捷回复"按钮
2. 填写信息：
   - 标题：`欢迎语`
   - 内容：`您好，我是Fiido客服，很高兴为您服务！`
   - 分类：选择"问候"
   - 快捷键：留空
   - 团队共享：不勾选
3. 点击"创建"

**预期结果**：
✅ 弹出成功提示
✅ 快捷回复列表中出现新创建的项
✅ 显示分类标签"欢迎语"（蓝色）
✅ 使用次数显示为 0

---

**测试用例2: 创建带变量的快捷回复**

**操作步骤**：

1. 点击"➕ 新建快捷回复"
2. 填写信息：
   - 标题：`个性化欢迎`
   - 内容：`您好{customer_name}，我是{agent_name}，很高兴为您服务！`
   - 分类：选择"问候"
   - 快捷键：`1`
   - 团队共享：勾选
3. 点击"创建"

**预期结果**：
✅ 表单下方显示"检测到变量: customer_name, agent_name"
✅ 创建成功
✅ 列表中显示"🌐 团队共享"标签
✅ 显示变量标签（黄色背景）

---

**测试用例3: 创建售后快捷回复**

**操作步骤**：

1. 创建以下快捷回复：
   - 标题：`退换货政策`
   - 内容：`您好，关于退换货：我们提供7天无理由退换货服务。请您提供订单号{order_id}，我帮您查询处理。`
   - 分类：售后
   - 快捷键：`2`
   - 团队共享：勾选

**预期结果**：
✅ 检测到变量 `order_id`
✅ 分类显示为"售后"（橙色标签）
✅ 快捷键提示：Ctrl+2

---

#### 1.3 编辑快捷回复

**操作步骤**：

1. 找到刚才创建的"欢迎语"
2. 点击"✏️"编辑按钮
3. 修改内容为：`您好，我是Fiido官方客服，很高兴为您服务！请问有什么可以帮助您的？`
4. 点击"保存"

**预期结果**：
✅ 保存成功
✅ 列表中内容已更新

---

#### 1.4 删除快捷回复

**操作步骤**：

1. 创建一个测试用的快捷回复
2. 点击"🗑️"删除按钮
3. 确认删除

**预期结果**：
✅ 弹出确认对话框
✅ 确认后删除成功
✅ 列表中不再显示该项

---

#### 1.5 筛选功能测试

**测试用例1: 按分类筛选**

**操作步骤**：

1. 在分类下拉框选择"问候"
2. 观察列表变化

**预期结果**：
✅ 只显示"问候"分类的快捷回复
✅ 其他分类的隐藏

---

**测试用例2: 搜索功能**

**操作步骤**：

1. 在搜索框输入"退换"
2. 观察列表变化

**预期结果**：
✅ 只显示标题或内容包含"退换"的快捷回复
✅ 实时搜索（500ms防抖）

---

**测试用例3: 只看我的**

**操作步骤**：

1. 勾选"只看我的"复选框
2. 观察列表变化

**预期结果**：
✅ 只显示当前坐席创建的快捷回复
✅ 团队共享的快捷回复被隐藏

---

### 📋 阶段2: 工作台使用快捷回复测试

#### 2.1 进入工作台

**操作步骤**：

1. 点击左上角"客服工作台"或访问 http://localhost:5174/dashboard
2. 等待会话列表加载

**预期结果**：
✅ 看到会话列表
✅ 看到统计信息（待接入、服务中等）

---

#### 2.2 创建测试会话（模拟用户发起对话）

**操作步骤**：

1. 打开新的浏览器标签页
2. 访问用户端（如果有）或使用 API 创建会话：

```bash
# 使用 curl 模拟用户发起对话
curl -X POST http://localhost:8000/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "你好，我想咨询一下产品",
    "user_id": "test_user_001"
  }'
```

3. 回到坐席工作台，刷新页面

**预期结果**：
✅ 会话列表中出现新会话
✅ 状态为"待接入"

---

#### 2.3 接入会话

**操作步骤**：

1. 在会话列表中找到刚才创建的会话
2. 点击"接入会话"按钮

**预期结果**：
✅ 会话状态变为"服务中"
✅ 右侧显示聊天历史
✅ 底部出现消息输入框
✅ **看到快捷短语按钮（📝 图标）**

---

#### 2.4 使用快捷回复面板

**操作步骤**：

1. 在消息输入框左侧，找到快捷短语按钮（📝）
2. 点击按钮
3. 观察快捷回复面板

**预期结果**：
✅ 弹出快捷回复面板（在输入框上方）
✅ 显示分类列表（问候、售前、售后等）
✅ 每个分类显示快捷回复数量
✅ 面板有白色背景，带阴影

---

#### 2.5 展开分类查看快捷回复

**操作步骤**：

1. 点击"问候"分类
2. 观察展开内容

**预期结果**：
✅ 分类展开，显示该分类下的快捷回复
✅ 每个快捷回复显示：

- 标题（粗体）
- 内容预览（灰色，前40字符）
- 🌐 图标（如果是团队共享）
- 变量标签（黄色背景，如 `{customer_name}`）
- 快捷键提示（蓝色文字，如"快捷键: Ctrl+1"）

---

#### 2.6 选择快捷回复

**操作步骤**：

1. 点击"个性化欢迎"快捷回复
2. 观察消息输入框

**预期结果**：
✅ 快捷回复内容自动填入消息输入框
✅ 快捷回复面板自动关闭
✅ 输入框内容为：`您好{customer_name}，我是{agent_name}，很高兴为您服务！`
✅ 可以手动编辑内容后发送

---

#### 2.7 搜索快捷回复

**操作步骤**：

1. 再次打开快捷回复面板
2. 在搜索框输入"退换"
3. 观察结果

**预期结果**：
✅ 只显示包含"退换"关键词的快捷回复
✅ 其他快捷回复被隐藏
✅ 搜索结果按分类分组

---

### 📋 阶段3: 权限测试

#### 3.1 普通坐席权限测试

**操作步骤**：

1. 退出登录
2. 使用 `agent001/agent123` 登录
3. 进入快捷回复管理页面
4. 尝试编辑管理员创建的快捷回复

**预期结果**：
✅ 可以看到团队共享的快捷回复
✅ 编辑按钮对其他人创建的快捷回复显示为禁用
✅ 删除按钮对其他人创建的快捷回复显示为禁用
✅ 只能编辑/删除自己创建的快捷回复

---

### 📋 阶段4: 变量替换测试（高级功能）

#### 4.1 使用带变量的快捷回复

**操作步骤**：

1. 在快捷回复管理页面，找到"个性化欢迎"
2. 点击"▶️"使用按钮
3. 观察弹出的使用对话框

**预期结果**：
✅ 显示原始内容：`您好{customer_name}，我是{agent_name}，很高兴为您服务！`
✅ 显示变量输入框：

- `customer_name:` [输入框]
- `agent_name:` [输入框]
  ✅ 显示"替换后"预览区域

---

#### 4.2 填写变量值

**操作步骤**：

1. 在 `customer_name` 输入框填入：`张三`
2. 在 `agent_name` 输入框填入：`李客服`
3. 观察预览区域

**预期结果**：
✅ 替换后内容实时更新为：`您好张三，我是李客服，很高兴为您服务！`
✅ 预览区域背景为绿色
✅ "复制内容"按钮可用

---

#### 4.3 复制到剪贴板

**操作步骤**：

1. 点击"复制内容"按钮
2. 粘贴到任意文本框测试

**预期结果**：
✅ 显示"已复制到剪贴板"提示
✅ 对话框自动关闭
✅ 粘贴的内容为替换后的文本（无变量占位符）

---

## 常见问题排查

### Q1: 快捷回复面板打开后是空的？

**排查步骤**：

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 查看是否有错误日志
4. 检查 Network 标签，看 `/api/quick-replies` 请求是否成功

**可能原因**：

- 后端服务未启动（8000端口）
- 数据库中没有快捷回复数据
- Token 过期或无效

**解决方案**：

```bash
# 检查后端服务
lsof -i :8000

# 查看后端日志
tail -f /tmp/backend_module3_v3.log

# 手动创建测试数据（见下方脚本）
```

---

### Q2: 点击快捷回复按钮没反应？

**可能原因**：

- 没有接入会话（只有在 `manual_live` 状态才能使用）
- 前端 JavaScript 错误

**解决方案**：

1. 确保已经点击"接入会话"按钮
2. 检查浏览器控制台是否有 JavaScript 错误
3. 刷新页面重试

---

### Q3: 创建快捷回复时提示"保存失败"？

**可能原因**：

- 标题或内容为空
- Token 过期
- 后端服务异常

**解决方案**：

1. 确保标题和内容都已填写
2. 重新登录获取新 Token
3. 检查后端日志

---

## 创建测试数据脚本

如果数据库中快捷回复太少，可以运行以下脚本创建测试数据：

```bash
#!/bin/bash
# 文件: /home/yzh/AI客服/鉴权/tests/create_quick_reply_test_data.sh

# 1. 登录获取 Token
TOKEN=$(curl -s -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  | jq -r '.token')

echo "Token: $TOKEN"

# 2. 创建问候分类快捷回复
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "标准欢迎语",
    "content": "您好，我是Fiido官方客服，很高兴为您服务！",
    "category": "greeting",
    "is_shared": true
  }'

curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "个性化欢迎",
    "content": "您好{customer_name}，我是{agent_name}，很高兴为您服务！",
    "category": "greeting",
    "shortcut_key": "1",
    "is_shared": true
  }'

# 3. 创建售前分类快捷回复
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "产品咨询",
    "content": "关于{product_name}，我来为您详细介绍一下主要特性和优势...",
    "category": "pre_sales",
    "shortcut_key": "2",
    "is_shared": true
  }'

# 4. 创建售后分类快捷回复
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "退换货政策",
    "content": "您好，关于退换货：我们提供7天无理由退换货服务。请您提供订单号{order_id}，我帮您查询处理。",
    "category": "after_sales",
    "shortcut_key": "3",
    "is_shared": true
  }'

# 5. 创建物流分类快捷回复
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "物流查询",
    "content": "您的订单{order_id}当前状态：{order_status}，物流单号：{tracking_number}",
    "category": "logistics",
    "is_shared": true
  }'

# 6. 创建结束语
curl -X POST http://localhost:8000/api/quick-replies \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "满意度调查",
    "content": "感谢您的咨询！如果您对本次服务满意，欢迎给我们一个好评。祝您生活愉快！",
    "category": "closing",
    "shortcut_key": "9",
    "is_shared": true
  }'

echo "✅ 测试数据创建完成！"
```

---

## 验收标准


| 功能点       | 验收标准                 | 状态 |
| ------------ | ------------------------ | ---- |
| 创建快捷回复 | 可成功创建并显示在列表中 | ⬜   |
| 编辑快捷回复 | 可编辑并保存修改         | ⬜   |
| 删除快捷回复 | 可删除并从列表移除       | ⬜   |
| 分类筛选     | 筛选结果正确             | ⬜   |
| 搜索功能     | 搜索结果正确             | ⬜   |
| 变量检测     | 自动检测并显示变量       | ⬜   |
| 团队共享     | 共享标识正确显示         | ⬜   |
| 工作台选择   | 点击快捷回复可填入输入框 | ⬜   |
| 变量替换     | 变量替换功能正常         | ⬜   |
| 权限控制     | 普通坐席只能编辑自己的   | ⬜   |

---

**测试完成后请填写上方表格并反馈问题！**
