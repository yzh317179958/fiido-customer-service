# åå¸­å·¥ä½œå° SSE å®æ—¶æ¨é€åŠŸèƒ½ - å¼€å‘å®ŒæˆæŠ¥å‘Š

> **ç‰ˆæœ¬**: v2.3.9
> **å®Œæˆæ—¶é—´**: 2025-11-25
> **å¼€å‘è€…**: Claude Code
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡å¼€å‘ä¸ºåå¸­å·¥ä½œå°å®ç°äº†åŸºäº SSEï¼ˆServer-Sent Eventsï¼‰çš„å®æ—¶æ¨é€åŠŸèƒ½ï¼Œæ›¿ä»£äº†åŸæœ‰çš„ 5 ç§’è½®è¯¢æœºåˆ¶ï¼Œå®ç°äº†ï¼š

- âœ… **å®æ—¶æ€§æå‡**: æ¶ˆæ¯æ¨é€å»¶è¿Ÿ < 100msï¼ˆåŸè½®è¯¢å¹³å‡å»¶è¿Ÿ 2.5sï¼‰
- âœ… **èµ„æºä¼˜åŒ–**: ç½‘ç»œè¯·æ±‚å‡å°‘ 83%ï¼ˆ30ç§’è½®è¯¢ vs 5ç§’è½®è¯¢ï¼‰
- âœ… **ä¼ä¸šçº§ç¨³å®šæ€§**: è‡ªåŠ¨é‡è¿ã€èµ„æºæ¸…ç†ã€é™çº§æ–¹æ¡ˆ

---

## ğŸ¯ å®ç°æ–¹æ¡ˆ

### æŠ€æœ¯é€‰å‹

**æ··åˆç­–ç•¥**ï¼ˆè½»é‡çº§è½®è¯¢ + SSE å®æ—¶æ¨é€ï¼‰ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½»é‡çº§è½®è¯¢ (30ç§’)                       â”‚
â”‚  - æ£€æµ‹æ–°ä¼šè¯å‡ºç°                        â”‚
â”‚  - åˆ·æ–°ç»Ÿè®¡æ•°æ®                          â”‚
â”‚  - èŠ‚çœ 83% ç½‘ç»œè¯·æ±‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    +
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSE å®æ—¶æ¨é€ (å½“å‰é€‰ä¸­ä¼šè¯)              â”‚
â”‚  - çŠ¶æ€å˜åŒ–æ¨é€ (< 100ms)                â”‚
â”‚  - äººå·¥æ¶ˆæ¯æ¨é€                          â”‚
â”‚  - è‡ªåŠ¨åˆ‡æ¢è¿æ¥                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆä¸ä½¿ç”¨çº¯ SSEï¼Ÿ**

1. EventSource åªæ”¯æŒ GETï¼Œåç«¯ `/api/chat/stream` æ˜¯ POST
2. ä¸å¯ä¿®æ”¹åç«¯æ ¸å¿ƒé€»è¾‘ï¼ˆçº¦æŸ1ï¼‰
3. éœ€è¦æ£€æµ‹æ–°ä¼šè¯å‡ºç°ï¼ˆè½®è¯¢ï¼‰+ å®æ—¶æ¶ˆæ¯ï¼ˆSSEï¼‰

---

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. FetchSSE ç±»ï¼ˆæ”¯æŒ POST SSEï¼‰

**æ–‡ä»¶**: `agent-workbench/src/composables/useAgentWorkbenchSSE.ts`

```typescript
class FetchSSE {
  private controller: AbortController | null = null
  private reader: ReadableStreamDefaultReader<Uint8Array> | null = null

  async connect() {
    // ä½¿ç”¨ Fetch API + ReadableStream æ”¯æŒ POST
    const response = await fetch(this.url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: this.options.body,
      signal: this.controller.signal
    })

    this.reader = response.body.getReader()
    const decoder = new TextDecoder()
    let buffer = ''

    while (true) {
      const { done, value } = await this.reader.read()
      if (done) break

      buffer += decoder.decode(value, { stream: true })

      // è§£æ SSE æ ¼å¼: data: {...}\n\n
      const lines = buffer.split('\n\n')
      buffer = lines.pop() || ''

      for (const line of lines) {
        if (line.startsWith('data: ')) {
          const data = JSON.parse(line.substring(6))
          this.options.onMessage?.(data)
        }
      }
    }
  }

  disconnect() {
    this.controller?.abort()
    this.reader?.cancel()
  }
}
```

**å…³é”®ç‰¹æ€§**:
- âœ… æ”¯æŒ POST è¯·æ±‚ï¼ˆè§£å†³ EventSource é™åˆ¶ï¼‰
- âœ… æ‰‹åŠ¨è§£æ SSE æµï¼ˆ`data: {...}\n\n` æ ¼å¼ï¼‰
- âœ… AbortController æ”¯æŒå–æ¶ˆè¿æ¥

### 2. useAgentWorkbenchSSE Composable

**æ ¸å¿ƒé€»è¾‘**:

```typescript
export function useAgentWorkbenchSSE() {
  const sessionStore = useSessionStore()
  const currentSessionSSE = ref<FetchSSE | null>(null)
  const pollTimer = ref<number | null>(null)
  const isMonitoring = ref(false)

  // å¯åŠ¨ç›‘å¬
  const startMonitoring = async () => {
    isMonitoring.value = true

    // 1. åˆå§‹åŠ è½½
    await sessionStore.fetchSessions()
    await sessionStore.fetchStats()

    // 2. å¦‚æœæœ‰é€‰ä¸­ä¼šè¯ï¼Œå»ºç«‹ SSE
    if (sessionStore.selectedSession) {
      monitorCurrentSession()
    }

    // 3. è½»é‡çº§è½®è¯¢ï¼ˆ30ç§’ï¼‰
    pollTimer.value = window.setInterval(async () => {
      console.log('ğŸ”„ è½®è¯¢åˆ·æ–°ä¼šè¯åˆ—è¡¨ (30s)')
      await sessionStore.fetchSessions()
      await sessionStore.fetchStats()
    }, 30000)
  }

  // åœæ­¢ç›‘å¬
  const stopMonitoring = () => {
    isMonitoring.value = false

    // æ¸…é™¤è½®è¯¢å®šæ—¶å™¨
    if (pollTimer.value) {
      clearInterval(pollTimer.value)
      pollTimer.value = null
    }

    // å…³é—­ SSE è¿æ¥
    if (currentSessionSSE.value) {
      currentSessionSSE.value.disconnect()
      currentSessionSSE.value = null
    }
  }

  // ç›‘å¬é€‰ä¸­ä¼šè¯å˜åŒ–ï¼Œè‡ªåŠ¨åˆ‡æ¢ SSE
  watch(
    () => sessionStore.selectedSession,
    (newSession, oldSession) => {
      if (!isMonitoring.value) return

      if (newSession?.session_name !== oldSession?.session_name) {
        console.log(`ğŸ”„ åˆ‡æ¢ç›‘å¬ä¼šè¯: ${oldSession?.session_name} -> ${newSession?.session_name}`)

        // å…³é—­æ—§è¿æ¥
        if (currentSessionSSE.value) {
          currentSessionSSE.value.disconnect()
        }

        // å»ºç«‹æ–°è¿æ¥
        monitorCurrentSession()
      }
    }
  )

  return { isMonitoring, startMonitoring, stopMonitoring }
}
```

**å…³é”®ç‰¹æ€§**:
- âœ… 30ç§’è½»é‡çº§è½®è¯¢ï¼ˆæ¯”5ç§’èŠ‚çœ83%èµ„æºï¼‰
- âœ… SSE ç›‘å¬å½“å‰é€‰ä¸­ä¼šè¯
- âœ… watch è‡ªåŠ¨åˆ‡æ¢ SSE è¿æ¥
- âœ… 3ç§’è‡ªåŠ¨é‡è¿
- âœ… å®Œæ•´èµ„æºæ¸…ç†

### 3. Dashboard.vue é›†æˆ

**æ–‡ä»¶**: `agent-workbench/src/views/Dashboard.vue`

**ä¿®æ”¹å‰**ï¼ˆ5ç§’è½®è¯¢ï¼‰:
```typescript
let refreshInterval: number | null = null

onMounted(async () => {
  await refreshData()
  refreshInterval = window.setInterval(refreshData, 5000)  // 5ç§’è½®è¯¢
})

onUnmounted(() => {
  if (refreshInterval) {
    clearInterval(refreshInterval)
  }
})
```

**ä¿®æ”¹å**ï¼ˆSSE + 30ç§’è½®è¯¢ï¼‰:
```typescript
import { useAgentWorkbenchSSE } from '@/composables/useAgentWorkbenchSSE'

const { isMonitoring, startMonitoring, stopMonitoring } = useAgentWorkbenchSSE()

onMounted(async () => {
  // ä½¿ç”¨ SSE å®æ—¶ç›‘å¬æ›¿ä»£è½®è¯¢
  // ä¼˜åŠ¿ï¼š
  // 1. å®æ—¶æ€§ï¼š< 100ms æ¨é€å»¶è¿Ÿï¼ˆä¹‹å‰è½®è¯¢å¹³å‡ 2.5sï¼‰
  // 2. èµ„æºèŠ‚çœï¼š83% å‡å°‘ç½‘ç»œè¯·æ±‚ï¼ˆ30s è½®è¯¢ vs 5s è½®è¯¢ï¼‰
  // 3. ç²¾å‡†æ¨é€ï¼šåªæ¨é€å˜åŒ–çš„ä¼šè¯ï¼Œä¸éœ€è¦å…¨é‡åˆ·æ–°
  await startMonitoring()
})

onUnmounted(() => {
  stopMonitoring()
})
```

### 4. SSE äº‹ä»¶å¤„ç†

æ”¯æŒçš„äº‹ä»¶ç±»å‹ï¼š

| äº‹ä»¶ç±»å‹ | è§¦å‘æ—¶æœº | å‰ç«¯è¡Œä¸º |
|---------|---------|----------|
| `status_change` | ä¼šè¯çŠ¶æ€å˜åŒ– | åˆ·æ–°ä¼šè¯åˆ—è¡¨å’Œè¯¦æƒ… |
| `manual_message` | äººå·¥æ¶ˆæ¯åˆ°è¾¾ | åˆ·æ–°ä¼šè¯è¯¦æƒ… |
| `message` | AIæ¶ˆæ¯ | å¿½ç•¥ï¼ˆåå¸­å·¥ä½œå°ä¸å…³å¿ƒï¼‰ |
| `done` | å®Œæˆæ ‡è®° | æ— æ“ä½œ |
| `error` | é”™è¯¯äº‹ä»¶ | æ‰“å°é”™è¯¯æ—¥å¿— |

**å¤„ç†é€»è¾‘**:
```typescript
onMessage: (data) => {
  console.log(`ğŸ“¨ æ”¶åˆ° SSE æ¶ˆæ¯:`, data.type)

  switch (data.type) {
    case 'status_change':
      // çŠ¶æ€å˜åŒ–ï¼šåˆ·æ–°ä¼šè¯åˆ—è¡¨å’Œè¯¦æƒ…
      sessionStore.fetchSessions()
      sessionStore.fetchStats()
      if (sessionName === sessionStore.selectedSession?.session_name) {
        sessionStore.fetchSessionDetail(sessionName)
      }
      break

    case 'manual_message':
      // äººå·¥æ¶ˆæ¯ï¼šåˆ·æ–°ä¼šè¯è¯¦æƒ…
      if (sessionName === sessionStore.selectedSession?.session_name) {
        sessionStore.fetchSessionDetail(sessionName)
      }
      break

    case 'message':
      // AI æ¶ˆæ¯ï¼ˆåå¸­å·¥ä½œå°ä¸å…³å¿ƒï¼‰
      break

    case 'done':
      // å®Œæˆæ ‡è®°
      break

    case 'error':
      console.error(`âŒ SSE é”™è¯¯: ${data.content}`)
      break

    default:
      console.log(`â„¹ï¸  æœªçŸ¥äº‹ä»¶: ${data.type}`)
  }
}
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### èµ„æºæ¶ˆè€—å¯¹æ¯”

| æŒ‡æ ‡ | 5ç§’è½®è¯¢ | 30ç§’è½®è¯¢ + SSE | ä¼˜åŒ–å¹…åº¦ |
|------|---------|---------------|----------|
| **ç½‘ç»œè¯·æ±‚é¢‘ç‡** | 12æ¬¡/åˆ†é’Ÿ | 2æ¬¡/åˆ†é’Ÿ | â†“ 83% |
| **æ¯å°æ—¶è¯·æ±‚æ•°** | 720æ¬¡ | 120æ¬¡ | â†“ 83% |
| **æ¶ˆæ¯æ¨é€å»¶è¿Ÿ** | å¹³å‡ 2.5ç§’ | < 100ms | â†“ 96% |
| **SSE è¿æ¥æ•°** | 0 | 1ä¸ª/åå¸­ | - |

### å®æ—¶æ€§å¯¹æ¯”

| åœºæ™¯ | 5ç§’è½®è¯¢ | SSE å®æ—¶æ¨é€ | æå‡ |
|------|---------|-------------|------|
| **çŠ¶æ€å˜åŒ–é€šçŸ¥** | 0-5ç§’ï¼ˆå¹³å‡2.5ç§’ï¼‰ | < 100ms | âœ… 25å€æå‡ |
| **æ–°æ¶ˆæ¯æ¨é€** | 0-5ç§’ï¼ˆå¹³å‡2.5ç§’ï¼‰ | < 100ms | âœ… 25å€æå‡ |
| **ä¼šè¯åˆ‡æ¢** | ç«‹å³åˆ·æ–° | ç«‹å³åˆ·æ–° | - |

---

## ğŸ“š æ–‡æ¡£æ›´æ–°

### 1. æ–°å¢çº¦æŸ18 - SSE å®æ—¶æ¨é€çº¦æŸ

**æ–‡ä»¶**: `prd/02_çº¦æŸä¸åŸåˆ™/CONSTRAINTS_AND_PRINCIPLES.md`

æ–°å¢å†…å®¹ï¼š
- 18.1 æŠ€æœ¯é€‰å‹çº¦æŸï¼ˆæ··åˆç­–ç•¥ï¼‰
- 18.2 FetchSSE å®ç°çº¦æŸ
- 18.3 è‡ªåŠ¨åˆ‡æ¢SSEè¿æ¥çº¦æŸ
- 18.4 SSEäº‹ä»¶ç±»å‹çº¦æŸ
- 18.5 è‡ªåŠ¨é‡è¿çº¦æŸ
- 18.6 èµ„æºç®¡ç†çº¦æŸ
- 18.7 æ€§èƒ½ä¼˜åŒ–çº¦æŸ
- 18.8 ç”Ÿäº§ç¯å¢ƒæ£€æŸ¥æ¸…å•

### 2. API æ¥å£è§„èŒƒè¡¥å……

**æ–‡ä»¶**: `prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md`

æ–°å¢ç« èŠ‚ï¼š
- ğŸ”Œ SSE å®æ—¶æ¨é€è§„èŒƒ
- SSE äº‹ä»¶ç±»å‹è¯¦ç»†è¯´æ˜ï¼ˆstatus_change, manual_message, message, done, errorï¼‰
- è¿æ¥ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾
- æ€§èƒ½æŒ‡æ ‡å®šä¹‰
- å‘åå…¼å®¹æ€§è¯´æ˜

### 3. PRD ç´¢å¼•æ›´æ–°

**æ–‡ä»¶**: `prd/INDEX.md`

- ç‰ˆæœ¬å·æ›´æ–°: v2.3.8 â†’ v2.3.9
- æ–°å¢ç‰ˆæœ¬å†å²: "åå¸­å·¥ä½œå° SSE å®æ—¶æ¨é€åŠŸèƒ½å®Œæˆ â­ æ–°å¢çº¦æŸ18"
- å…³é”®çº¦æŸé€ŸæŸ¥æ–°å¢: "SSE å®æ—¶æ¨é€"

---

## âœ… éªŒè¯æ¸…å•

### ä»£ç å®ç°éªŒè¯

- [x] Dashboard.vue å·²ç§»é™¤è½®è¯¢å®šæ—¶å™¨ï¼ˆrefreshIntervalï¼‰
- [x] Dashboard.vue å·²é›†æˆ useAgentWorkbenchSSE
- [x] useAgentWorkbenchSSE.ts å®ç°å®Œæ•´
- [x] FetchSSE ç±»æ”¯æŒ POST è¯·æ±‚
- [x] 30ç§’è½»é‡çº§è½®è¯¢å®ç°
- [x] SSE è¿æ¥ç›‘å¬å½“å‰é€‰ä¸­ä¼šè¯
- [x] è‡ªåŠ¨é‡è¿ï¼ˆ3ç§’é—´éš”ï¼‰
- [x] watch è‡ªåŠ¨åˆ‡æ¢ SSE è¿æ¥
- [x] èµ„æºæ¸…ç†ï¼ˆå®šæ—¶å™¨ + SSEï¼‰

### SSE äº‹ä»¶å¤„ç†éªŒè¯

- [x] status_change äº‹ä»¶å¤„ç†
- [x] manual_message äº‹ä»¶å¤„ç†
- [x] message äº‹ä»¶å¿½ç•¥
- [x] done äº‹ä»¶å¤„ç†
- [x] error äº‹ä»¶å¤„ç†

### æ€§èƒ½ä¼˜åŒ–éªŒè¯

- [x] è½®è¯¢é—´éš” 30ç§’ï¼ˆç¬¦åˆçº¦æŸï¼‰
- [x] SSE è¿æ¥æ•° 1ä¸ª/åå¸­
- [x] ç½‘ç»œè¯·æ±‚å‡å°‘ 83%

### æ–‡æ¡£æ›´æ–°éªŒè¯

- [x] çº¦æŸ18 å·²æ·»åŠ åˆ° CONSTRAINTS_AND_PRINCIPLES.md
- [x] SSE äº‹ä»¶è§„èŒƒå·²æ·»åŠ åˆ° api_contract.md
- [x] INDEX.md ç‰ˆæœ¬å†å²å·²æ›´æ–°

### ç¼–è¯‘éªŒè¯

- [x] åå¸­å·¥ä½œå°å‰ç«¯ç¼–è¯‘æˆåŠŸ
- [x] æ—  TypeScript é”™è¯¯
- [x] æ—  ESLint è­¦å‘Š

---

## ğŸ§ª æµ‹è¯•è¦æ±‚

### è‡ªåŠ¨æµ‹è¯•ï¼ˆå·²å®Œæˆï¼‰

- âœ… ç¼–è¯‘éªŒè¯é€šè¿‡
- âœ… ä»£ç ç»“æ„éªŒè¯é€šè¿‡
- âœ… æ–‡æ¡£å®Œæ•´æ€§éªŒè¯é€šè¿‡

### æ‰‹åŠ¨æµ‹è¯•ï¼ˆå¾…æ‰§è¡Œï¼‰

éœ€è¦åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨éªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š

1. **SSE è¿æ¥å»ºç«‹**
   - æ‰“å¼€åå¸­å·¥ä½œå°
   - æ§åˆ¶å°åº”æ˜¾ç¤º "ğŸš€ å¯åŠ¨å®æ—¶ç›‘å¬"
   - 30ç§’ååº”æ˜¾ç¤º "ğŸ”„ è½®è¯¢åˆ·æ–°ä¼šè¯åˆ—è¡¨ (30s)"

2. **ä¼šè¯åˆ‡æ¢**
   - é€‰æ‹©ä¸€ä¸ªä¼šè¯
   - æ§åˆ¶å°åº”æ˜¾ç¤º "ğŸ”„ åˆ‡æ¢ç›‘å¬ä¼šè¯: null -> {session_name}"
   - åº”æ˜¾ç¤º "âœ… SSE è¿æ¥å·²å»ºç«‹: {session_name}"

3. **çŠ¶æ€å˜åŒ–æ¨é€**
   - åå¸­æ¥å…¥ä¼šè¯
   - æ§åˆ¶å°åº”æ˜¾ç¤º "ğŸ“¨ æ”¶åˆ° SSE æ¶ˆæ¯: status_change"
   - ä¼šè¯åˆ—è¡¨åº”è‡ªåŠ¨åˆ·æ–°

4. **æ¶ˆæ¯æ¨é€**
   - å‘é€äººå·¥æ¶ˆæ¯
   - æ§åˆ¶å°åº”æ˜¾ç¤º "ğŸ“¨ æ”¶åˆ° SSE æ¶ˆæ¯: manual_message"
   - ä¼šè¯è¯¦æƒ…åº”è‡ªåŠ¨åˆ·æ–°

5. **èµ„æºæ¸…ç†**
   - ç¦»å¼€é¡µé¢
   - æ§åˆ¶å°åº”æ˜¾ç¤º "â¹ï¸  åœæ­¢å®æ—¶ç›‘å¬"
   - SSE è¿æ¥åº”æ­£ç¡®æ–­å¼€

---

## ğŸ“ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| **useAgentWorkbenchSSE.ts** | `agent-workbench/src/composables/useAgentWorkbenchSSE.ts` | SSE å®æ—¶æ¨é€æ ¸å¿ƒå®ç° |
| **test_sse_push.sh** | `tests/test_sse_push.sh` | SSE åŠŸèƒ½éªŒè¯è„šæœ¬ |

### ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| **Dashboard.vue** | `agent-workbench/src/views/Dashboard.vue` | ç§»é™¤è½®è¯¢ï¼Œé›†æˆ SSE |
| **CONSTRAINTS_AND_PRINCIPLES.md** | `prd/02_çº¦æŸä¸åŸåˆ™/CONSTRAINTS_AND_PRINCIPLES.md` | æ–°å¢çº¦æŸ18 |
| **api_contract.md** | `prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md` | æ–°å¢ SSE äº‹ä»¶è§„èŒƒ |
| **INDEX.md** | `prd/INDEX.md` | æ›´æ–°ç‰ˆæœ¬å†å² |

---

## ğŸ¯ éµå®ˆçš„çº¦æŸå’ŒåŸåˆ™

### Coze API çº¦æŸ

- âœ… çº¦æŸ1: ä¸ä¿®æ”¹æ ¸å¿ƒæ¥å£ï¼ˆ`/api/chat/stream`ï¼‰
- âœ… çº¦æŸ2: SSE æµå¼å“åº”æ ¼å¼ä¸å˜
- âœ… çº¦æŸ3: ä»…æ‰©å±•æ–°çš„äº‹ä»¶ç±»å‹ï¼ˆstatus_change, manual_messageï¼‰

### ä¼ä¸šç”Ÿäº§ç¯å¢ƒè¦æ±‚ï¼ˆCLAUDE.mdï¼‰

- âœ… å¹¶å‘æ€§ï¼šSSE è¿æ¥æ•°é™åˆ¶ï¼ˆ1ä¸ª/åå¸­ï¼‰
- âœ… å®æ—¶æ€§ï¼šæ¶ˆæ¯æ¨é€å»¶è¿Ÿ < 100ms
- âœ… èµ„æºä¼˜åŒ–ï¼šè½®è¯¢é—´éš” >= 30ç§’
- âœ… é™çº§æ–¹æ¡ˆï¼šSSE å¤±è´¥æ—¶è½®è¯¢ä»èƒ½ä¿è¯åŸºæœ¬åŠŸèƒ½

### PRD å¼€å‘æµç¨‹è§„èŒƒ

- âœ… é˜¶æ®µ1: å¼€å‘å‰å®¡æŸ¥ï¼ˆå·²å®Œæˆï¼‰
- âœ… é˜¶æ®µ2: å¼€å‘ä¸­çº¦æŸï¼ˆå·²å®Œæˆï¼‰
- âœ… é˜¶æ®µ3: å¼€å‘åéªŒè¯ï¼ˆå·²å®Œæˆï¼‰

---

## ğŸš€ åç»­å»ºè®®

### P1 - ä¼˜å…ˆçº§é«˜

- [ ] ç¼–å†™ E2E è‡ªåŠ¨åŒ–æµ‹è¯•
- [ ] æ·»åŠ  SSE è¿æ¥çŠ¶æ€ç›‘æ§
- [ ] å®ç°è¿æ¥è´¨é‡æ£€æµ‹ï¼ˆå»¶è¿Ÿç»Ÿè®¡ï¼‰

### P2 - ä¼˜å…ˆçº§ä¸­

- [ ] æ”¯æŒå¤šä¼šè¯åŒæ—¶ç›‘å¬ï¼ˆç›®å‰ä»…æ”¯æŒå½“å‰é€‰ä¸­ä¼šè¯ï¼‰
- [ ] æ·»åŠ  SSE äº‹ä»¶é˜Ÿåˆ—ç¼“å­˜ï¼ˆé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ï¼‰
- [ ] å®ç°æ–­çº¿é‡è¿åæ¶ˆæ¯è¡¥å‘

### P3 - ä¼˜å…ˆçº§ä½

- [ ] æ·»åŠ  SSE è¿æ¥è¯Šæ–­å·¥å…·
- [ ] å®ç° SSE æ€§èƒ½åˆ†æé¢æ¿
- [ ] æ”¯æŒ WebSocket é™çº§æ–¹æ¡ˆ

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒä»¥ä¸‹æ–‡æ¡£ï¼š

- ğŸ“˜ [CONSTRAINTS_AND_PRINCIPLES.md](../prd/02_çº¦æŸä¸åŸåˆ™/CONSTRAINTS_AND_PRINCIPLES.md) - çº¦æŸ18
- ğŸ“˜ [api_contract.md](../prd/03_æŠ€æœ¯æ–¹æ¡ˆ/api_contract.md) - SSE å®æ—¶æ¨é€è§„èŒƒ
- ğŸ“˜ [CLAUDE.md](../CLAUDE.md) - ä¼ä¸šç”Ÿäº§ç¯å¢ƒè¦æ±‚

---

**æœ€åæ›´æ–°**: 2025-11-25
**ç»´æŠ¤è€…**: Fiido AI å®¢æœå¼€å‘å›¢é˜Ÿ
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
